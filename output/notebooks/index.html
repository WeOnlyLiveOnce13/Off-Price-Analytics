<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dan A. Tshisungu">
<meta name="dcterms.date" content="2025-06-28">
<meta name="description" content="In this project, we attempt to provide insights on Faro and its retail business of discounted branded products.">

<title>FARO OFF-PRICE RETAIL ANALYTICS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #f8f9fa;
      }

      .quarto-title-block .quarto-title-banner {
        color: #f8f9fa;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-right">
      <h1 class="title">FARO OFF-PRICE RETAIL ANALYTICS</h1>
            <p class="subtitle lead">A data-driven approach to understanding what drives off-price sales</p>
                  <div>
        <div class="description">
          In this project, we attempt to provide insights on Faro and its retail business of discounted branded products.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-right">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dan A. Tshisungu </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 28, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#i.-introduction" id="toc-i.-introduction" class="nav-link active" data-scroll-target="#i.-introduction">I. INTRODUCTION</a>
  <ul class="collapse">
  <li><a href="#i.1.-background" id="toc-i.1.-background" class="nav-link" data-scroll-target="#i.1.-background">I.1. Background</a></li>
  <li><a href="#i.2.-project-objective" id="toc-i.2.-project-objective" class="nav-link" data-scroll-target="#i.2.-project-objective">I.2. Project Objective</a></li>
  <li><a href="#i.-3.-data-overview" id="toc-i.-3.-data-overview" class="nav-link" data-scroll-target="#i.-3.-data-overview">I. 3. Data Overview:</a></li>
  </ul></li>
  <li><a href="#ii.-data-preparation" id="toc-ii.-data-preparation" class="nav-link" data-scroll-target="#ii.-data-preparation">II. DATA PREPARATION</a>
  <ul class="collapse">
  <li><a href="#ii.1.-loading-the-dataset" id="toc-ii.1.-loading-the-dataset" class="nav-link" data-scroll-target="#ii.1.-loading-the-dataset">II.1. Loading the dataset</a></li>
  <li><a href="#ii.2.-dataset-inspection" id="toc-ii.2.-dataset-inspection" class="nav-link" data-scroll-target="#ii.2.-dataset-inspection">II.2. Dataset Inspection</a></li>
  <li><a href="#ii.3.-data-quality-issues" id="toc-ii.3.-data-quality-issues" class="nav-link" data-scroll-target="#ii.3.-data-quality-issues">II.3. Data Quality issues</a>
  <ul class="collapse">
  <li><a href="#ii.3.1.-duplicate-values" id="toc-ii.3.1.-duplicate-values" class="nav-link" data-scroll-target="#ii.3.1.-duplicate-values">II.3.1. Duplicate values</a></li>
  <li><a href="#ii.3.2.-missing-value-analysis" id="toc-ii.3.2.-missing-value-analysis" class="nav-link" data-scroll-target="#ii.3.2.-missing-value-analysis">II.3.2. Missing value analysis</a></li>
  <li><a href="#ii.3.3.-distribution-analysis" id="toc-ii.3.3.-distribution-analysis" class="nav-link" data-scroll-target="#ii.3.3.-distribution-analysis">II.3.3. Distribution analysis</a></li>
  <li><a href="#ii.3.4.-data-preparation" id="toc-ii.3.4.-data-preparation" class="nav-link" data-scroll-target="#ii.3.4.-data-preparation">II.3.4. Data preparation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#iii.-exploratory-data-analysis---eda" id="toc-iii.-exploratory-data-analysis---eda" class="nav-link" data-scroll-target="#iii.-exploratory-data-analysis---eda">III. EXPLORATORY DATA ANALYSIS - EDA</a>
  <ul class="collapse">
  <li><a href="#iii.1.-units-and-revenue-analysis" id="toc-iii.1.-units-and-revenue-analysis" class="nav-link" data-scroll-target="#iii.1.-units-and-revenue-analysis">III.1. Units and Revenue Analysis</a>
  <ul class="collapse">
  <li><a href="#sales-information" id="toc-sales-information" class="nav-link" data-scroll-target="#sales-information">Sales information</a></li>
  <li><a href="#units-analysis" id="toc-units-analysis" class="nav-link" data-scroll-target="#units-analysis">Units Analysis</a></li>
  <li><a href="#revenue-analysis" id="toc-revenue-analysis" class="nav-link" data-scroll-target="#revenue-analysis">Revenue Analysis</a></li>
  </ul></li>
  <li><a href="#iii.2.-discount-effect-on-top-brands-suppliers" id="toc-iii.2.-discount-effect-on-top-brands-suppliers" class="nav-link" data-scroll-target="#iii.2.-discount-effect-on-top-brands-suppliers">III.2. Discount effect on top brands &amp; suppliers</a></li>
  <li><a href="#iii.3.-average-turnover-per-store" id="toc-iii.3.-average-turnover-per-store" class="nav-link" data-scroll-target="#iii.3.-average-turnover-per-store">III.3. Average turnover per store</a></li>
  <li><a href="#iii.4.-clearance-impact" id="toc-iii.4.-clearance-impact" class="nav-link" data-scroll-target="#iii.4.-clearance-impact">III.4. Clearance Impact</a></li>
  <li><a href="#iii.5.-customer-behavior" id="toc-iii.5.-customer-behavior" class="nav-link" data-scroll-target="#iii.5.-customer-behavior">III.5. Customer behavior</a></li>
  </ul></li>
  <li><a href="#iv.-predictive-modelling" id="toc-iv.-predictive-modelling" class="nav-link" data-scroll-target="#iv.-predictive-modelling">IV. PREDICTIVE MODELLING</a>
  <ul class="collapse">
  <li><a href="#iv.1.-target-feature" id="toc-iv.1.-target-feature" class="nav-link" data-scroll-target="#iv.1.-target-feature">IV.1. Target Feature</a></li>
  <li><a href="#iv.2.-feature-selection" id="toc-iv.2.-feature-selection" class="nav-link" data-scroll-target="#iv.2.-feature-selection">IV.2. Feature Selection</a>
  <ul class="collapse">
  <li><a href="#numerical-and-categorical-features" id="toc-numerical-and-categorical-features" class="nav-link" data-scroll-target="#numerical-and-categorical-features">Numerical and Categorical features</a></li>
  <li><a href="#base-model" id="toc-base-model" class="nav-link" data-scroll-target="#base-model">Base model</a></li>
  </ul></li>
  <li><a href="#iv.3.-feature-engineering" id="toc-iv.3.-feature-engineering" class="nav-link" data-scroll-target="#iv.3.-feature-engineering">IV.3. Feature Engineering</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block column-page-right" id="quarto-document-content">





<section id="i.-introduction" class="level1">
<h1>I. INTRODUCTION</h1>
<section id="i.1.-background" class="level2">
<h2 class="anchored" data-anchor-id="i.1.-background">I.1. Background</h2>
<p>Faro, an off-price retailer that specialises in selling branded products at discounted prices. The business wants to understand which product types, brands, and<br>
suppliers move fastest, how pricing affects inventory turnover, and how customer shopping habits vary by region and time.</p>
</section>
<section id="i.2.-project-objective" class="level2">
<h2 class="anchored" data-anchor-id="i.2.-project-objective">I.2. Project Objective</h2>
<p>The main objectives of this project are:</p>
<ol type="1">
<li>clean and prepare the data for analysis by identifying possible quality issues.</li>
<li>Perform a business-oriented exploratory data analysis (EDA) to identify key insights on how specific discounts and features influence the company’s sales, business performance, and customer behavior.</li>
<li>Build and evaluate a predictive model to predict whether a given product will be sold on clearance or not.</li>
</ol>
</section>
<section id="i.-3.-data-overview" class="level2">
<h2 class="anchored" data-anchor-id="i.-3.-data-overview">I. 3. Data Overview:</h2>
<p>We load the dataset and assess its structure and summary statistics.</p>
<p><strong>Dataset Description</strong></p>
<ul>
<li><strong>TransactionID</strong>: Unique ID for each transaction</li>
<li><strong>StoreID</strong>: Store location identifier</li>
<li><strong>Date</strong>: Date of transaction</li>
<li><strong>ProductID</strong>: Unique product identifier</li>
<li><strong>Brand</strong>: Product brand</li>
<li><strong>Supplier</strong>: Supplier of the product</li>
<li><strong>Category</strong>: Top-level product category (e.g., Apparel, Footwear, Accessories, Kids)</li>
<li><strong>Subcategory</strong>: Second-level product classification (e.g., Tops, Boots, Bags, Boys)</li>
<li><strong>Type</strong>: Third-level, most granular product type (e.g., T-shirt, Sneakers, Clutch, Puzzle)</li>
<li><strong>OriginalPrice</strong>: Original list price</li>
<li><strong>DiscountedPrice</strong>: Actual sale price</li>
<li><strong>Quantity</strong>: Number of units sold (can be negative for returns)</li>
<li><strong>CustomerID</strong>: Encrypted customer ID</li>
<li><strong>Region</strong>: Store region (e.g., GP, WC, KZN)</li>
</ul>
</section>
</section>
<section id="ii.-data-preparation" class="level1">
<h1>II. DATA PREPARATION</h1>
<section id="ii.1.-loading-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="ii.1.-loading-the-dataset">II.1. Loading the dataset</h2>
<p>We load the dataset and display the first 10 transactions.</p>
<div id="data-loading" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> boxcox</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> skew</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PowerTransformer, QuantileTransformer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mutual_info_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction <span class="im">import</span> DictVectorizer</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, precision_score, recall_score, classification_report</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold, cross_validate</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.under_sampling <span class="im">import</span> RandomUnderSampler</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> RandomOverSampler</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lets_plot <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>LetsPlot.setup_html()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'../data/raw/offprice_transactions.csv'</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="data-loading-1" class="cell-output cell-output-display">

            <div id="8zfh2n"></div>
            <script type="text/javascript" data-lets-plot-script="library">
                if(!window.letsPlotCallQueue) {
                    window.letsPlotCallQueue = [];
                }; 
                window.letsPlotCall = function(f) {
                    window.letsPlotCallQueue.push(f);
                };
                (function() {
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = "https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js";
                    script.onload = function() {
                        window.letsPlotCall = function(f) {f();};
                        window.letsPlotCallQueue.forEach(function(f) {f();});
                        window.letsPlotCallQueue = [];
                        
                    };
                    script.onerror = function(event) {
                        window.letsPlotCall = function(f) {};    // noop
                        window.letsPlotCallQueue = [];
                        var div = document.createElement("div");
                        div.style.color = 'darkred';
                        div.textContent = 'Error loading Lets-Plot JS';
                        document.getElementById("8zfh2n").appendChild(div);
                    };
                    var e = document.getElementById("8zfh2n");
                    e.appendChild(script);
                })()
            </script>
            
</div>
<div id="data-loading-2" class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">DiscountedPrice</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">CustomerID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">ClearanceFlag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T100000</td>
<td>S008</td>
<td>2024-04-12</td>
<td>P4655</td>
<td>Puma</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sneakers</td>
<td>Lifestyle Sneakers</td>
<td>243.03</td>
<td>194.42</td>
<td>5</td>
<td>C18185</td>
<td>WC</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>T100001</td>
<td>S007</td>
<td>2024-04-12</td>
<td>P9119</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>144.83</td>
<td>130.35</td>
<td>5</td>
<td>C23031</td>
<td>KZN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>T100002</td>
<td>S008</td>
<td>2024-04-09</td>
<td>P4186</td>
<td>Puma</td>
<td>SoleSupplier</td>
<td>Kids</td>
<td>Girls</td>
<td>Dress</td>
<td>60.00</td>
<td>36.00</td>
<td>4</td>
<td>C82590</td>
<td>GP</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>T100003</td>
<td>S008</td>
<td>2024-02-07</td>
<td>P2999</td>
<td>Ralph Lauren</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>20.22</td>
<td>8.09</td>
<td>2</td>
<td>C57438</td>
<td>GP</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>T100004</td>
<td>S009</td>
<td>2024-01-22</td>
<td>P2853</td>
<td>Michael Kors</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>21.98</td>
<td>19.78</td>
<td>2</td>
<td>C60203</td>
<td>WC</td>
<td>No</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="ii.2.-dataset-inspection" class="level2">
<h2 class="anchored" data-anchor-id="ii.2.-dataset-inspection">II.2. Dataset Inspection</h2>
<p>We check the number of observations and features in the dataset.</p>
<div id="data-shape" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code>Our dataset has 100000 transactions and 15 features.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The dataset contains <strong>100000 transactions (records)</strong> and is composed of <strong>15 features</strong>.</p>
</div>
</div>
<p><strong>Features types:</strong></p>
<p>We check the feature types to find out what feature may need conversion.</p>
<div id="cell-features-types" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="features-types" class="cell-output cell-output-display" data-execution_count="4">
<pre><code>TransactionID       object
StoreID             object
Date                object
ProductID           object
Brand               object
Supplier            object
Category            object
Subcategory         object
Type                object
OriginalPrice      float64
DiscountedPrice    float64
Quantity             int64
CustomerID          object
Region              object
ClearanceFlag       object
dtype: object</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Features Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Features Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>Date</code> feature has to be converted into a datetime feature, and temporal features (day, week, month) extracted from it.</li>
<li>Create <code>DiscountPercent</code> feature from the price features.</li>
<li>Create <code>Revenue</code> feature based on both <code>Price</code> and <code>Quantity</code>. Refer to <a href="#cau-revenue" class="quarto-xref">Caution&nbsp;1</a>.</li>
</ul>
</div>
</div>
</div>
<p><strong>Feature Information:</strong></p>
<div id="features-info" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 100000 entries, 0 to 99999
Data columns (total 15 columns):
 #   Column           Non-Null Count   Dtype  
---  ------           --------------   -----  
 0   TransactionID    100000 non-null  object 
 1   StoreID          100000 non-null  object 
 2   Date             100000 non-null  object 
 3   ProductID        100000 non-null  object 
 4   Brand            100000 non-null  object 
 5   Supplier         100000 non-null  object 
 6   Category         100000 non-null  object 
 7   Subcategory      100000 non-null  object 
 8   Type             100000 non-null  object 
 9   OriginalPrice    100000 non-null  float64
 10  DiscountedPrice  100000 non-null  float64
 11  Quantity         100000 non-null  int64  
 12  CustomerID       100000 non-null  object 
 13  Region           100000 non-null  object 
 14  ClearanceFlag    100000 non-null  object 
dtypes: float64(2), int64(1), object(12)
memory usage: 11.4+ MB</code></pre>
</div>
</div>
<div id="cau-revenue" class="callout callout-style-default callout-caution callout-titled" title="Revenue formula">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution&nbsp;1: Revenue formula
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Some products are sold at normal price while others are sold at a discounted price.<br>
Thus, the formula for the <code>Revenue</code> feature is:</p>
<p><span class="math display">\[
\text{Revenue} =
\begin{cases}
\text{Quantity} \times \text{OriginalPrice}, &amp; \text{if } \texttt{ClearanceFlag} = \texttt{No} \\
\text{Quantity} \times \text{DiscountedPrice}, &amp; \text{if } \texttt{ClearanceFlag} = \texttt{Yes}
\end{cases}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="ii.3.-data-quality-issues" class="level2">
<h2 class="anchored" data-anchor-id="ii.3.-data-quality-issues">II.3. Data Quality issues</h2>
<p>We now check any data quality issues:</p>
<ul>
<li>duplicate values</li>
<li>missing values</li>
<li>skewness of the distribution</li>
<li>outliers</li>
<li>incorrect feature formating etc</li>
</ul>
<section id="ii.3.1.-duplicate-values" class="level3">
<h3 class="anchored" data-anchor-id="ii.3.1.-duplicate-values">II.3.1. Duplicate values</h3>
<div id="cell-duplicate-check" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.duplicated().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="duplicate-check" class="cell-output cell-output-display" data-execution_count="6">
<pre><code>False</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are no duplicate value in the dataset.</p>
</div>
</div>
</section>
<section id="ii.3.2.-missing-value-analysis" class="level3">
<h3 class="anchored" data-anchor-id="ii.3.2.-missing-value-analysis">II.3.2. Missing value analysis</h3>
<p>Below we check the number of missing value for each feature:</p>
<div id="cell-missing-value" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="missing-value" class="cell-output cell-output-display" data-execution_count="7">
<pre><code>TransactionID      False
StoreID            False
Date               False
ProductID          False
Brand              False
Supplier           False
Category           False
Subcategory        False
Type               False
OriginalPrice      False
DiscountedPrice    False
Quantity           False
CustomerID         False
Region             False
ClearanceFlag      False
dtype: bool</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are no missing value in the dataset. There is therefore no need for handling incomplete records.</p>
</div>
</div>
</section>
<section id="ii.3.3.-distribution-analysis" class="level3">
<h3 class="anchored" data-anchor-id="ii.3.3.-distribution-analysis">II.3.3. Distribution analysis</h3>
<p>We check the distribution of both the numerical and categorical features. But first we extract numerical and categorical features.</p>
<div id="feature-type-extraction" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>numerical_columns <span class="op">=</span> df.select_dtypes(include<span class="op">=</span><span class="st">"number"</span>).columns.to_list()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> df.select_dtypes(exclude<span class="op">=</span><span class="st">"number"</span>).columns.to_list()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f" **Numerical features in the dataset:** </span><span class="sc">{</span>numerical_columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f" **Categorical features in the dataset:** </span><span class="sc">{</span>categorical_columns<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> **Numerical features in the dataset:** ['OriginalPrice', 'DiscountedPrice', 'Quantity']
 **Categorical features in the dataset:** ['TransactionID', 'StoreID', 'Date', 'ProductID', 'Brand', 'Supplier', 'Category', 'Subcategory', 'Type', 'CustomerID', 'Region', 'ClearanceFlag']</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember we have to convert the <code>Date</code> feature later on.</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" title="Distribution analysis">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Numerical features</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Categorical features</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Target feature : <code>ClearanceFlag</code></a></li></ul>
<div class="tab-content" title="Distribution analysis">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div id="cell-numerical-stats" class="cell" data-execution_count="9">
<div id="lst-numerical-feature" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored" data-code-fold="true">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-numerical-feature-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Numerical features description
</figcaption>
<div aria-describedby="lst-numerical-feature-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
<div id="numerical-stats" class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">DiscountedPrice</th>
<th data-quarto-table-cell-role="th">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>100000.000000</td>
<td>100000.000000</td>
<td>100000.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>160.068899</td>
<td>107.431994</td>
<td>2.770260</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>80.798129</td>
<td>59.216377</td>
<td>1.698319</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>20.010000</td>
<td>8.000000</td>
<td>-2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>89.720000</td>
<td>58.140000</td>
<td>2.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>160.180000</td>
<td>103.060000</td>
<td>3.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>230.060000</td>
<td>149.980000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>300.000000</td>
<td>270.000000</td>
<td>5.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can also visualize the distribution below:</p>
<div id="numerical-distribution" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>numerical <span class="op">=</span> [<span class="st">"OriginalPrice"</span>, <span class="st">"DiscountedPrice"</span>, <span class="st">"Quantity"</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> numerical: </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract skewness</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    skewness <span class="op">=</span> skew(df[feat])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Skewness is </span><span class="sc">{</span>skewness<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate plot</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> (ggplot(df, aes(x<span class="op">=</span>feat)) <span class="op">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>         geom_density(color<span class="op">=</span><span class="st">'darkgreen'</span>, alpha<span class="op">=</span><span class="fl">.7</span>) <span class="op">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>         ggtitle(<span class="ss">f"Distribution of </span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss"> (Skewness: </span><span class="sc">{</span>skewness<span class="sc">:.2f}</span><span class="ss">)"</span>) <span class="op">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>         xlab(feat) <span class="op">+</span> ylab(<span class="st">"Density"</span>) <span class="op">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>         theme_minimal())</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    display(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>OriginalPrice:
Skewness is -0.0028062700583212194</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/numerical-distribution-output-2.png" id="numerical-distribution-1" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>DiscountedPrice:
Skewness is 0.35201956858296896</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/numerical-distribution-output-4.png" id="numerical-distribution-2" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Quantity:
Skewness is -0.576037618829498</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/numerical-distribution-output-6.png" id="numerical-distribution-3" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Numerical feature Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Numerical feature Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>OriginalPrice</code> feature is uniformly distributed meaning products are sold throughout the price range and no particular <code>OriginalPrice</code> is informative.</li>
<li><code>DiscountedPrice</code> feature is skewed to the right meaning most products are sold at a lower <code>DiscountedPrice</code>, up to <code>R140</code>, compared to higher prices, above <code>R150</code>.</li>
<li><code>Quantity</code> feature has a minimum of <strong>-2</strong> meaning one or two items returned every now and then.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="cell-categorical-count-distribution" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.describe(exclude<span class="op">=</span><span class="st">"number"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="categorical-count-distribution" class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">CustomerID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">ClearanceFlag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>100000</td>
<td>10</td>
<td>140</td>
<td>9000</td>
<td>10</td>
<td>7</td>
<td>4</td>
<td>16</td>
<td>51</td>
<td>60470</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>T100000</td>
<td>S002</td>
<td>2024-02-23</td>
<td>P2610</td>
<td>Tommy Hilfiger</td>
<td>Asos</td>
<td>Accessories</td>
<td>Hats</td>
<td>Shorts</td>
<td>C76591</td>
<td>KZN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>1</td>
<td>10102</td>
<td>776</td>
<td>27</td>
<td>10180</td>
<td>23446</td>
<td>25122</td>
<td>6469</td>
<td>3654</td>
<td>9</td>
<td>33460</td>
<td>79980</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can have a more detailed view of the categorical features below:</p>
<div id="categorical-distribution" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> [<span class="st">"StoreID"</span>, <span class="st">"ProductID"</span>, <span class="st">"Brand"</span>, <span class="st">"Supplier"</span>, <span class="st">"Category"</span>, <span class="st">"Subcategory"</span>, <span class="st">"Type"</span>, <span class="st">"CustomerID"</span>, <span class="st">"Region"</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> categories:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> unique values: </span><span class="sc">{</span>df[col]<span class="sc">.</span>value_counts()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--"</span><span class="op">*</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>StoreID unique values: StoreID
S002    10102
S007    10066
S008    10037
S003    10036
S001    10014
S005     9987
S010     9973
S004     9954
S009     9950
S006     9881
Name: count, dtype: int64
----------------------------------------
ProductID unique values: ProductID
P2610    27
P1976    26
P7930    25
P2591    25
P1640    25
         ..
P9560     2
P6268     2
P6560     2
P1952     2
P6495     2
Name: count, Length: 9000, dtype: int64
----------------------------------------
Brand unique values: Brand
Tommy Hilfiger    10180
Ralph Lauren      10129
Under Armour      10119
Adidas            10002
Zara               9992
Michael Kors       9932
DKNY               9932
Puma               9918
Guess              9913
Nike               9883
Name: count, dtype: int64
----------------------------------------
Supplier unique values: Supplier
Asos              23446
Nordstrom         15197
Bloomingdale's    14981
Macy's            14867
JD Sports         13441
Inditex            9992
SoleSupplier       8076
Name: count, dtype: int64
----------------------------------------
Category unique values: Category
Accessories    25122
Apparel        25022
Kids           25007
Footwear       24849
Name: count, dtype: int64
----------------------------------------
Subcategory unique values: Subcategory
Hats         6469
Boys         6416
Tops         6336
Flats        6311
Belts        6291
Toys         6258
Boots        6256
Jewelry      6248
Dresses      6246
Bottoms      6232
Outerwear    6208
Sneakers     6174
Baby         6173
Girls        6160
Bags         6114
Sandals      6108
Name: count, dtype: int64
----------------------------------------
Type unique values: Type
Shorts                3654
T-shirt               3648
Loafers               2148
Sneakers              2142
Puzzle                2130
Espadrilles           2125
Elastic Belt          2122
Running Shoes         2120
Casual Dress          2114
Booties               2106
Bracelet              2105
Sandals               2105
Knee-high Boots       2102
Canvas Belt           2093
Ankle Boots           2084
Action Figure         2084
Evening Dress         2083
Earrings              2079
Leather Belt          2076
Dress                 2074
Flip Flops            2072
Chelsea Boots         2070
Necklace              2064
Basketball Shoes      2052
Maxi Dress            2049
Slides                2045
Plush Toy             2044
Onesie                2038
Ballet Flats          2038
Rompers               2029
Lifestyle Sneakers    2002
Gladiator Sandals     1991
Leggings              1981
Fedora                1646
Cap                   1635
Skirt                 1623
Tank Top              1619
Bucket Hat            1611
Blouse                1604
Shirt                 1590
Clutch                1585
Beanie                1577
Trousers              1569
Puffer                1561
Jacket                1560
Tote                  1550
Blazer                1544
Coat                  1543
Jeans                 1535
Satchel               1516
Backpack              1463
Name: count, dtype: int64
----------------------------------------
CustomerID unique values: CustomerID
C76591    9
C36989    8
C68230    8
C42539    8
C99455    7
         ..
C23917    1
C19435    1
C39164    1
C63404    1
C90467    1
Name: count, Length: 60470, dtype: int64
----------------------------------------
Region unique values: Region
KZN    33460
GP     33438
WC     33102
Name: count, dtype: int64
----------------------------------------</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Categorical features Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Categorical features Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Some customers have multiple transactions, so <code>CustomerID</code> is not unique.</li>
<li>9000 unique products are sold</li>
<li>10 unique brands and stores</li>
<li>Products are bought in 7 different quantities, may need to investigate further for a correlation between quantity and price.</li>
<li>60470 unique customers, maybe investigate or cluster them based on their purchasing behavior.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div id="cell-target-variable" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ClearanceFlag"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="target-variable" class="cell-output cell-output-display" data-execution_count="13">
<pre><code>ClearanceFlag
No     79980
Yes    20020
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Target feature Insight">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Target feature Insight
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Out of 100000 items sold:</p>
<ul>
<li>79980, ~80%, were not on clearance sale</li>
<li>20020, ~20%, were on clearance sale</li>
<li>Stores sell mostly items at the normal rate.</li>
<li>A highly imbalanced dataset (1:4 ratio) for building a predictive model.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="ii.3.4.-data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="ii.3.4.-data-preparation">II.3.4. Data preparation</h3>
<p>We prepare the data for further analysis.</p>
<p><strong>A. Formatting features</strong></p>
<p>We convert the date feature in a datetime type, and we ensure numerical features are properly set.</p>
<div id="feature-formatting" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'OriginalPrice'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'OriginalPrice'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DiscountedPrice'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'DiscountedPrice'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Quantity'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'Quantity'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>B. Feature preparation</strong></p>
<p>At this stage <a href="#lst-numerical-feature" class="quarto-xref">Listing&nbsp;1</a>, we observed that the lowest of value of the <code>Quantity</code> feature is <strong>-2</strong>. We must take care of returned products as well create a <code>Revenue</code> <a href="#cau-revenue" class="quarto-xref">Caution&nbsp;1</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Features">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Features
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Every returned product was entered as a negative number. We create a new feature to describe if a product is return. e.g <code>IsReturn</code>.</li>
<li>Machine learning behave differently to the presence of negative numbers such as quantity = -1. We must consider both the business logic (A negative quantity means a return and thus an opportunity loss) and the model performance impact.</li>
</ul>
</div>
</div>
<div id="cell-return-feature" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Separate quantities and create indicators</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'QuantityAbs'</span>] <span class="op">=</span> df[<span class="st">'Quantity'</span>].<span class="bu">abs</span>()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify returns</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsReturn'</span>] <span class="op">=</span> (df[<span class="st">'Quantity'</span>] <span class="op">&lt;</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TransactionType'</span>] <span class="op">=</span> df[<span class="st">'Quantity'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Return'</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'Sale'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create revenue Revenue with proper handling</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'RevenueAbs'</span>] <span class="op">=</span> np.where(df[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                            df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'OriginalPrice'</span>],</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                            df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'DiscountedPrice'</span>])</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create final Revenue (negative for returns)</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'RevenueFinal'</span>] <span class="op">=</span> np.where(df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">1</span>, </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                              <span class="op">-</span>df[<span class="st">'RevenueAbs'</span>], </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                              df[<span class="st">'RevenueAbs'</span>])</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Drop original Quantity if desired</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Quantity'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. create time-based features</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Year'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.year</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Month'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.month</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'WeekOfYear'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.isocalendar().week</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DayOfWeek'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.dayofweek</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Calculate discount percentage</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DiscountPercentage'</span>] <span class="op">=</span> ((df[<span class="st">'OriginalPrice'</span>] <span class="op">-</span> df[<span class="st">'DiscountedPrice'</span>]) <span class="op">/</span> df[<span class="st">'OriginalPrice'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="return-feature" class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">QuantityAbs</th>
<th data-quarto-table-cell-role="th">IsReturn</th>
<th data-quarto-table-cell-role="th">TransactionType</th>
<th data-quarto-table-cell-role="th">RevenueAbs</th>
<th data-quarto-table-cell-role="th">RevenueFinal</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">WeekOfYear</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">DiscountPercentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T100000</td>
<td>S008</td>
<td>2024-04-12</td>
<td>P4655</td>
<td>Puma</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sneakers</td>
<td>Lifestyle Sneakers</td>
<td>243.03</td>
<td>...</td>
<td>5</td>
<td>0</td>
<td>Sale</td>
<td>1215.15</td>
<td>1215.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>20.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>T100001</td>
<td>S007</td>
<td>2024-04-12</td>
<td>P9119</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>144.83</td>
<td>...</td>
<td>5</td>
<td>0</td>
<td>Sale</td>
<td>724.15</td>
<td>724.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>10.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>T100002</td>
<td>S008</td>
<td>2024-04-09</td>
<td>P4186</td>
<td>Puma</td>
<td>SoleSupplier</td>
<td>Kids</td>
<td>Girls</td>
<td>Dress</td>
<td>60.00</td>
<td>...</td>
<td>4</td>
<td>0</td>
<td>Sale</td>
<td>240.00</td>
<td>240.00</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>1</td>
<td>40.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>T100003</td>
<td>S008</td>
<td>2024-02-07</td>
<td>P2999</td>
<td>Ralph Lauren</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>20.22</td>
<td>...</td>
<td>2</td>
<td>0</td>
<td>Sale</td>
<td>16.18</td>
<td>16.18</td>
<td>2024</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>59.99</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>T100004</td>
<td>S009</td>
<td>2024-01-22</td>
<td>P2853</td>
<td>Michael Kors</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>21.98</td>
<td>...</td>
<td>2</td>
<td>0</td>
<td>Sale</td>
<td>43.96</td>
<td>43.96</td>
<td>2024</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>10.01</td>
</tr>
</tbody>
</table>

<p>5 rows × 24 columns</p>
</div>
</div>
</div>
<p><strong>C. Outlier Analysis</strong></p>
<p>We observed above that <code>DiscountedPrice</code> is skewed to the right indicating the presence of outliers.</p>
<p>There are many ways to detect outliers:</p>
<ul>
<li>By calculating the skewness of the distribution and establishing a threshold</li>
<li>By visualizing the distribution of features</li>
<li>And more advanced methods more outlier detection</li>
<li>Using the IQR for the feature.</li>
</ul>
<p>Above we applied the first two. We can confirm that with the last method:</p>
<p>For <code>DiscountedPrice</code>, we have:</p>
<ul>
<li>min = 8</li>
<li>25% = 58</li>
<li>50% = 103</li>
<li>75% = 149.98</li>
<li>100% = 270</li>
</ul>
<p>By finding the difference between each interval, we can deduce from where outliers occur:</p>
<ul>
<li>25% - min = 50</li>
<li>50% - 25% = 45</li>
<li>75% - 50% = 46</li>
<li>100% - 75%= <code>120</code></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Outliers Insight">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Outliers Insight
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We notice a jump from 75th percentile to the 100th depicting outliers.</li>
<li>75th percentile + 50 = ~200. Anything above <code>200</code> in the <code>DiscountedPrice</code> is an outlier.</li>
<li>Though a mild skewness (0.35) is observed, we will attempt to deal with it.</li>
</ul>
</div>
</div>
<p><strong>Summary of transformations</strong></p>
<div id="outlier-analysis" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>transformations <span class="op">=</span> {}</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Original</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'Original'</span>] <span class="op">=</span> df[<span class="st">'DiscountedPrice'</span>]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Log transformation</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'Log'</span>] <span class="op">=</span> np.log1p(df[<span class="st">'DiscountedPrice'</span>])</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Square root</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'Sqrt'</span>] <span class="op">=</span> np.sqrt(df[<span class="st">'DiscountedPrice'</span>])</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Box-Cox</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'BoxCox'</span>], _ <span class="op">=</span> boxcox(df[<span class="st">'DiscountedPrice'</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Yeo-Johnson</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'yeo-johnson'</span>, standardize<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'YeoJohnson'</span>] <span class="op">=</span> pt.fit_transform(df[[<span class="st">'DiscountedPrice'</span>]]).flatten()</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare skewness</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> transformations.items():</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    skew_val <span class="op">=</span> stats.skew(data)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    results.append({<span class="st">'Transformation'</span>: name, <span class="st">'Skewness'</span>: skew_val})</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_df.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the best transformation (closest to 0)</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>best_transform <span class="op">=</span> comparison_df.loc[comparison_df[<span class="st">'Skewness'</span>].<span class="bu">abs</span>().idxmin(), <span class="st">'Transformation'</span>]</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best transformation: </span><span class="sc">{</span>best_transform<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transformation  Skewness
0       Original     0.352
1            Log    -0.781
2           Sqrt    -0.176
3         BoxCox    -0.116
4     YeoJohnson    -0.116

Best transformation: BoxCox</code></pre>
</div>
</div>
<p><strong>Final implementation</strong></p>
<div id="cell-final-implementation" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Box-Cox and store the Lambda value </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DiscountedPriceBoxCox'</span>], lambda_val <span class="op">=</span> boxcox(df[<span class="st">'DiscountedPrice'</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop original column</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'DiscountedPrice'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Update your revenue calculation with transformed prices</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'RevenueAbs'</span>] <span class="op">=</span> np.where(df[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                           df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'OriginalPrice'</span>],</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                           df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'DiscountedPriceBoxCox'</span>])</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"New skewness: </span><span class="sc">{</span>stats<span class="sc">.</span>skew(df[<span class="st">'DiscountedPriceBoxCox'</span>])<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>New skewness: -0.116</code></pre>
</div>
<div id="final-implementation" class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">IsReturn</th>
<th data-quarto-table-cell-role="th">TransactionType</th>
<th data-quarto-table-cell-role="th">RevenueAbs</th>
<th data-quarto-table-cell-role="th">RevenueFinal</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">WeekOfYear</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">DiscountPercentage</th>
<th data-quarto-table-cell-role="th">DiscountedPriceBoxCox</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T100000</td>
<td>S008</td>
<td>2024-04-12</td>
<td>P4655</td>
<td>Puma</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sneakers</td>
<td>Lifestyle Sneakers</td>
<td>243.03</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>1215.150000</td>
<td>1215.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>20.00</td>
<td>30.868606</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>T100001</td>
<td>S007</td>
<td>2024-04-12</td>
<td>P9119</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>144.83</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>724.150000</td>
<td>724.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>10.00</td>
<td>24.486402</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>T100002</td>
<td>S008</td>
<td>2024-04-09</td>
<td>P4186</td>
<td>Puma</td>
<td>SoleSupplier</td>
<td>Kids</td>
<td>Girls</td>
<td>Dress</td>
<td>60.00</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>240.000000</td>
<td>240.00</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>1</td>
<td>40.00</td>
<td>11.337297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>T100003</td>
<td>S008</td>
<td>2024-02-07</td>
<td>P2999</td>
<td>Ralph Lauren</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>20.22</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>8.567399</td>
<td>16.18</td>
<td>2024</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>59.99</td>
<td>4.283699</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>T100004</td>
<td>S009</td>
<td>2024-01-22</td>
<td>P2853</td>
<td>Michael Kors</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>21.98</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>43.960000</td>
<td>43.96</td>
<td>2024</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>10.01</td>
<td>7.776294</td>
</tr>
</tbody>
</table>

<p>5 rows × 24 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Summary of Data Preparation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary of Data Preparation
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We loaded our dataset and check its observations and features</li>
<li>We made sure there were no missing values nor any duplicated values</li>
<li>We created new features to enrich our dataset and make it more consistent for further analysis.</li>
<li>We converted <code>Date</code> and transformed the <code>DiscountedPrice</code> feature to handle the format for the former and outliers for the latter.</li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="iii.-exploratory-data-analysis---eda" class="level1">
<h1>III. EXPLORATORY DATA ANALYSIS - EDA</h1>
<p>We explore the dataset in depth and answer business questions.</p>
<p>Let us have a look at the updated dataset’s features:</p>
<section id="iii.1.-units-and-revenue-analysis" class="level2">
<h2 class="anchored" data-anchor-id="iii.1.-units-and-revenue-analysis">III.1. Units and Revenue Analysis</h2>
<section id="sales-information" class="level3">
<h3 class="anchored" data-anchor-id="sales-information">Sales information</h3>
<div id="data-overview" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sales transactions: </span><span class="sc">{</span>df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">0</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Return transactions: </span><span class="sc">{</span>df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">1</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Return rate: </span><span class="sc">{</span>df[<span class="st">'IsReturn'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sales transactions: 94,914
Return transactions: 5,086
Return rate: 0.051</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Sales Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sales Insights
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>Sales</code> account for 94.5% of all transactions while <code>returns</code> for ~ 5.1%.</li>
</ul>
</div>
</div>
<p>Because we focus on units sold and revenue, we filter to only use items that were not returned.</p>
<div id="data-filter" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_sales <span class="op">=</span> df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">0</span>].copy()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Analyzing </span><span class="sc">{</span>df_sales<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> sales transactions (excluding returns)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Analyzing 94,914 sales transactions (excluding returns)</code></pre>
</div>
</div>
</section>
<section id="units-analysis" class="level3">
<h3 class="anchored" data-anchor-id="units-analysis">Units Analysis</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" title="Sales analysis">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Supplier by Units</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Brand by Units</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Category by Units</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">Top Global Performers by Units</a></li></ul>
<div class="tab-content" title="Sales analysis">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div id="cell-supllier-units-plot" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> (</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    df_sales.groupby([<span class="st">'Region'</span>, <span class="st">'Supplier'</span>, <span class="st">'ClearanceFlag'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      .agg({<span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>, <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>})</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Order Supplier by total quantity across all ClearanceFlags</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>supplier_order <span class="op">=</span> (</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    grouped_df.groupby(<span class="st">'Supplier'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    .sort_values().index.tolist()</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>grouped_df[<span class="st">'Supplier'</span>] <span class="op">=</span> pd.Categorical(grouped_df[<span class="st">'Supplier'</span>], categories<span class="op">=</span>supplier_order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">"Yes"</span>: <span class="st">"#faca80"</span>, <span class="st">"No"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare plot</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">9</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>, bottom<span class="op">=</span><span class="fl">0.15</span>, left<span class="op">=</span><span class="fl">0.05</span>, right<span class="op">=</span><span class="fl">0.95</span>, wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom Title and Subtitle</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>highlight_color <span class="op">=</span> <span class="st">"#faca80"</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>subtitle_color <span class="op">=</span> <span class="st">"gray"</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>caption_color <span class="op">=</span> <span class="st">"#666666"</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>text_color <span class="op">=</span> <span class="st">"#151931"</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Supplier Contribution to Quantity Sold"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.925</span>,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>         <span class="ss">f"Comparison of Clearance status per Region"</span>,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span>subtitle_color)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> grouped_df[<span class="st">'Region'</span>].unique()</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    region_data <span class="op">=</span> grouped_df[grouped_df[<span class="st">'Region'</span>] <span class="op">==</span> region]</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>    suppliers <span class="op">=</span> region_data[<span class="st">'Supplier'</span>].cat.categories</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    clearance_yes <span class="op">=</span> []</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>    clearance_no <span class="op">=</span> []</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> supplier <span class="kw">in</span> suppliers:</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>        supplier_data <span class="op">=</span> region_data[region_data[<span class="st">'Supplier'</span>] <span class="op">==</span> supplier]</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>        yes_val <span class="op">=</span> supplier_data[supplier_data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>        no_val <span class="op">=</span> supplier_data[supplier_data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>][<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>        clearance_yes.append(yes_val)</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>        clearance_no.append(no_val)</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(suppliers))</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>    bar_height <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    bars_no <span class="op">=</span> ax.barh([y <span class="op">-</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos], clearance_no, </span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>                      bar_height, label<span class="op">=</span><span class="st">'No'</span>, color<span class="op">=</span>palette[<span class="st">'No'</span>])</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    bars_yes <span class="op">=</span> ax.barh([y <span class="op">+</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos], clearance_yes, </span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>                       bar_height, label<span class="op">=</span><span class="st">'Yes'</span>, color<span class="op">=</span>palette[<span class="st">'Yes'</span>])</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add data labels</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars_no:</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>            ax.text(width <span class="op">+</span> <span class="bu">max</span>(clearance_no) <span class="op">*</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(width)<span class="sc">:,}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_color, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars_yes:</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>            ax.text(width <span class="op">+</span> <span class="bu">max</span>(clearance_yes) <span class="op">*</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(width)<span class="sc">:,}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_color, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(suppliers)</span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Total Quantity'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span>text_color, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(<span class="kw">lambda</span> x, pos: <span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(x)<span class="sc">:,}</span><span class="ss">'</span>))</span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>        ax.legend(title<span class="op">=</span><span class="st">'Clearance Sale'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caption</span></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="st">'Source: Dan - Faro'</span>, </span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>caption_color)</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supllier-units-plot-output-1.png" id="supllier-units-plot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div id="cell-brand-units-plot" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> (</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    df_sales.groupby([<span class="st">'Region'</span>, <span class="st">'Brand'</span>, <span class="st">'ClearanceFlag'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      .agg({<span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>, <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>})</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Order Supplier by total quantity across all ClearanceFlags</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>brand_order <span class="op">=</span> (</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    grouped_df.groupby(<span class="st">'Brand'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    .sort_values().index.tolist()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>grouped_df[<span class="st">'Brand'</span>] <span class="op">=</span> pd.Categorical(grouped_df[<span class="st">'Brand'</span>], categories<span class="op">=</span>brand_order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">"Yes"</span>: <span class="st">"#faca80"</span>, <span class="st">"No"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare plot</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">9</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>, bottom<span class="op">=</span><span class="fl">0.15</span>, left<span class="op">=</span><span class="fl">0.05</span>, right<span class="op">=</span><span class="fl">0.95</span>, wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom Title and Subtitle</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>highlight_color <span class="op">=</span> <span class="st">"#faca80"</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>subtitle_color <span class="op">=</span> <span class="st">"gray"</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>caption_color <span class="op">=</span> <span class="st">"#666666"</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>text_color <span class="op">=</span> <span class="st">"#151931"</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Brand Contribution to Quantity Sold"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.925</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>         <span class="ss">f"Comparison of Clearance status per Region"</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span>subtitle_color)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> grouped_df[<span class="st">'Region'</span>].unique()</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    region_data <span class="op">=</span> grouped_df[grouped_df[<span class="st">'Region'</span>] <span class="op">==</span> region]</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    brands <span class="op">=</span> region_data[<span class="st">'Brand'</span>].cat.categories</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    clearance_yes <span class="op">=</span> []</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    clearance_no <span class="op">=</span> []</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> brand <span class="kw">in</span> brands:</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>        brand_data <span class="op">=</span> region_data[region_data[<span class="st">'Brand'</span>] <span class="op">==</span> brand]</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>        yes_val <span class="op">=</span> brand_data[brand_data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>        no_val <span class="op">=</span> brand_data[brand_data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>][<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>        clearance_yes.append(yes_val)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>        clearance_no.append(no_val)</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(brands))</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>    bar_height <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>    bars_no <span class="op">=</span> ax.barh([y <span class="op">-</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos], clearance_no, </span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>                      bar_height, label<span class="op">=</span><span class="st">'No'</span>, color<span class="op">=</span>palette[<span class="st">'No'</span>])</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>    bars_yes <span class="op">=</span> ax.barh([y <span class="op">+</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos], clearance_yes, </span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>                       bar_height, label<span class="op">=</span><span class="st">'Yes'</span>, color<span class="op">=</span>palette[<span class="st">'Yes'</span>])</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add data labels</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars_no:</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>            ax.text(width <span class="op">+</span> <span class="bu">max</span>(clearance_no) <span class="op">*</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(width)<span class="sc">:,}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_color, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars_yes:</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>            ax.text(width <span class="op">+</span> <span class="bu">max</span>(clearance_yes) <span class="op">*</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(width)<span class="sc">:,}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_color, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(brands)</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Total Quantity'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span>text_color, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(<span class="kw">lambda</span> x, pos: <span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(x)<span class="sc">:,}</span><span class="ss">'</span>))</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>        ax.legend(title<span class="op">=</span><span class="st">'Clearance Sale'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caption</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="st">'Source: Dan - Faro'</span>, </span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>caption_color)</span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/brand-units-plot-output-1.png" id="brand-units-plot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div id="cell-category-units-plot" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> (</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    df_sales.groupby([<span class="st">'Region'</span>, <span class="st">'Category'</span>, <span class="st">'ClearanceFlag'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      .agg({<span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>, <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>})</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>category_order <span class="op">=</span> (</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    grouped_df.groupby(<span class="st">'Category'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    .sort_values().index.tolist()</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>grouped_df[<span class="st">'Category'</span>] <span class="op">=</span> pd.Categorical(grouped_df[<span class="st">'Category'</span>], categories<span class="op">=</span>category_order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">"Yes"</span>: <span class="st">"#faca80"</span>, <span class="st">"No"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare plot</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">9</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>, bottom<span class="op">=</span><span class="fl">0.15</span>, left<span class="op">=</span><span class="fl">0.05</span>, right<span class="op">=</span><span class="fl">0.95</span>, wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom Title and Subtitle</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>highlight_color <span class="op">=</span> <span class="st">"#faca80"</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>subtitle_color <span class="op">=</span> <span class="st">"gray"</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>caption_color <span class="op">=</span> <span class="st">"#666666"</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>text_color <span class="op">=</span> <span class="st">"#151931"</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Category Contribution to Quantity Sold"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.925</span>,</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>         <span class="ss">f"Comparison of Clearance status per Region"</span>,</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span>subtitle_color)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> grouped_df[<span class="st">'Region'</span>].unique()</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    region_data <span class="op">=</span> grouped_df[grouped_df[<span class="st">'Region'</span>] <span class="op">==</span> region]</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> region_data[<span class="st">'Category'</span>].cat.categories</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    clearance_yes <span class="op">=</span> []</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    clearance_no <span class="op">=</span> []</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category <span class="kw">in</span> categories:</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>        category_data <span class="op">=</span> region_data[region_data[<span class="st">'Category'</span>] <span class="op">==</span> category]</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>        yes_val <span class="op">=</span> category_data[category_data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>        no_val <span class="op">=</span> category_data[category_data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>][<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>()</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>        clearance_yes.append(yes_val)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>        clearance_no.append(no_val)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(categories))</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    bar_height <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    bars_no <span class="op">=</span> ax.barh([y <span class="op">-</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos], clearance_no, </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>                      bar_height, label<span class="op">=</span><span class="st">'No'</span>, color<span class="op">=</span>palette[<span class="st">'No'</span>])</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    bars_yes <span class="op">=</span> ax.barh([y <span class="op">+</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos], clearance_yes, </span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>                       bar_height, label<span class="op">=</span><span class="st">'Yes'</span>, color<span class="op">=</span>palette[<span class="st">'Yes'</span>])</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add data labels</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars_no:</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>            ax.text(width <span class="op">+</span> <span class="bu">max</span>(clearance_no) <span class="op">*</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(width)<span class="sc">:,}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_color, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars_yes:</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>            ax.text(width <span class="op">+</span> <span class="bu">max</span>(clearance_yes) <span class="op">*</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(width)<span class="sc">:,}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_color, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(categories)</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Total Quantity'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span>text_color, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(<span class="kw">lambda</span> x, pos: <span class="ss">f'</span><span class="sc">{</span><span class="bu">int</span>(x)<span class="sc">:,}</span><span class="ss">'</span>))</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>        ax.legend(title<span class="op">=</span><span class="st">'Clearance Sale'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Add caption</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="st">'Source: Dan - Faro'</span>, </span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>caption_color)</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/category-units-plot-output-1.png" id="category-units-plot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div id="units-sold" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>units_by_category <span class="op">=</span> df_sales.groupby(<span class="st">'Category'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>units_by_brand <span class="op">=</span> df_sales.groupby(<span class="st">'Brand'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>units_by_supplier <span class="op">=</span> df_sales.groupby(<span class="st">'Supplier'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>category_units_df <span class="op">=</span> units_by_category.reset_index()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>category_units_df.columns <span class="op">=</span> [<span class="st">'Category'</span>, <span class="st">'Units'</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>brand_units_df <span class="op">=</span> units_by_brand.reset_index()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>brand_units_df.columns <span class="op">=</span> [<span class="st">'Brand'</span>, <span class="st">'Units'</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>supplier_units_df <span class="op">=</span> units_by_supplier.reset_index()</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>supplier_units_df.columns <span class="op">=</span> [<span class="st">'Supplier'</span>, <span class="st">'Units'</span>]</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 5 Categories by units sold:"</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (cat, units) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_category.head().items(), <span class="dv">1</span>):</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>units<span class="sc">:,}</span><span class="ss"> units"</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 Brands by units sold:"</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, units) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_brand.head().items(), <span class="dv">1</span>):</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>units<span class="sc">:,}</span><span class="ss"> units"</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 Suppliers by units sold:"</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, units) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_supplier.head().items(), <span class="dv">1</span>):</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>units<span class="sc">:,}</span><span class="ss"> units"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 Categories by units sold:
1. Accessories: 71,445 units
2. Apparel: 71,300 units
3. Kids: 71,154 units
4. Footwear: 70,780 units

Top 5 Brands by units sold:
1. Tommy Hilfiger: 28,915 units
2. Ralph Lauren: 28,840 units
3. Under Armour: 28,739 units
4. Adidas: 28,542 units
5. DKNY: 28,408 units

Top 5 Suppliers by units sold:
1. Asos: 66,762 units
2. Nordstrom: 43,342 units
3. Bloomingdale's: 42,764 units
4. Macy's: 42,366 units
5. JD Sports: 38,301 units</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="revenue-analysis" class="level3">
<h3 class="anchored" data-anchor-id="revenue-analysis">Revenue Analysis</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" title="Sales analysis">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Supplier by Revenue</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Brand by Revenue</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Category by Revenue</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Top Global Performers by Revenue</a></li></ul>
<div class="tab-content" title="Sales analysis">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div id="cell-supplier-revenue-plot" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> (</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    df_sales</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      .groupby([<span class="st">'Region'</span>, <span class="st">'Supplier'</span>, <span class="st">'ClearanceFlag'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      .agg({<span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>,              </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>})</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>supplier_order <span class="op">=</span> (</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    grouped_df.groupby(<span class="st">'Supplier'</span>)[<span class="st">'RevenueFinal'</span>]   </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>              .<span class="bu">sum</span>()</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>              .sort_values()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>              .index</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>              .tolist()</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>grouped_df[<span class="st">'Supplier'</span>] <span class="op">=</span> pd.Categorical(grouped_df[<span class="st">'Supplier'</span>],</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                                        categories<span class="op">=</span>supplier_order,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                                        ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>palette        <span class="op">=</span> {<span class="st">"Yes"</span>: <span class="st">"#faca80"</span>, <span class="st">"No"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>highlight_col  <span class="op">=</span> <span class="st">"#faca80"</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>subtitle_col   <span class="op">=</span> <span class="st">"gray"</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>caption_col    <span class="op">=</span> <span class="st">"#666666"</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>text_col       <span class="op">=</span> <span class="st">"#151931"</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">9</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>, bottom<span class="op">=</span><span class="fl">0.15</span>, left<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>                    right<span class="op">=</span><span class="fl">0.95</span>, wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Supplier Contribution to Revenue"</span>,</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.925</span>,</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Clearance vs Regular sales by region"</span>,</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span>subtitle_col)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> grouped_df[<span class="st">'Region'</span>].unique()</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>    region_data <span class="op">=</span> grouped_df[grouped_df[<span class="st">'Region'</span>] <span class="op">==</span> region]</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    suppliers       <span class="op">=</span> region_data[<span class="st">'Supplier'</span>].cat.categories</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    clearance_yes   <span class="op">=</span> []</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    clearance_no    <span class="op">=</span> []</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> supplier <span class="kw">in</span> suppliers:</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> region_data[region_data[<span class="st">'Supplier'</span>] <span class="op">==</span> supplier]</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>        yes_val <span class="op">=</span> data[data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>()</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>        no_val  <span class="op">=</span> data[data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>][<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>()</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>        clearance_yes.append(yes_val)</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>        clearance_no.append(no_val)</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>    y_pos      <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(suppliers))</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>    bar_height <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>    bars_no <span class="op">=</span> ax.barh([y <span class="op">-</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos],</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>                      clearance_no, bar_height,</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>                      label<span class="op">=</span><span class="st">'No'</span>, color<span class="op">=</span>palette[<span class="st">'No'</span>])</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>    bars_yes <span class="op">=</span> ax.barh([y <span class="op">+</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos],</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>                       clearance_yes, bar_height,</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">'Yes'</span>, color<span class="op">=</span>palette[<span class="st">'Yes'</span>])</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _add_labels(bars, offset):</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> bar.get_width()</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>                ax.text(width <span class="op">+</span> offset, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>                        <span class="ss">f"</span><span class="sc">{</span>width<span class="sc">:,.0f}</span><span class="ss">"</span>,      </span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>                        va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_col, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>    _add_labels(bars_no, <span class="bu">max</span>(clearance_no) <span class="op">*</span> <span class="fl">0.01</span> <span class="cf">if</span> clearance_no <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>    _add_labels(bars_yes, <span class="bu">max</span>(clearance_yes) <span class="op">*</span> <span class="fl">0.01</span> <span class="cf">if</span> clearance_yes <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(suppliers)</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Total Revenue'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>    ax.set_title(region, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>text_col, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(</span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x, _: <span class="ss">f"R </span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>      </span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelrotation<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>        ax.legend(title<span class="op">=</span><span class="st">'Clearance Sale'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="st">'Source: Dan – Faro'</span>,</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>caption_col)</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supplier-revenue-plot-output-1.png" id="supplier-revenue-plot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div id="cell-brand-revenue-plot" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> (</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    df_sales</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      .groupby([<span class="st">'Region'</span>, <span class="st">'Brand'</span>, <span class="st">'ClearanceFlag'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      .agg({<span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>,              </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>})</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>brand_order <span class="op">=</span> (</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    grouped_df.groupby(<span class="st">'Brand'</span>)[<span class="st">'RevenueFinal'</span>]   </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>              .<span class="bu">sum</span>()</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>              .sort_values()</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>              .index</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>              .tolist()</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>grouped_df[<span class="st">'Brand'</span>] <span class="op">=</span> pd.Categorical(grouped_df[<span class="st">'Brand'</span>],</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                                        categories<span class="op">=</span>brand_order,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                                        ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>palette        <span class="op">=</span> {<span class="st">"Yes"</span>: <span class="st">"#faca80"</span>, <span class="st">"No"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>highlight_col  <span class="op">=</span> <span class="st">"#faca80"</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>subtitle_col   <span class="op">=</span> <span class="st">"gray"</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>caption_col    <span class="op">=</span> <span class="st">"#666666"</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>text_col       <span class="op">=</span> <span class="st">"#151931"</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">9</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>, bottom<span class="op">=</span><span class="fl">0.15</span>, left<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>                    right<span class="op">=</span><span class="fl">0.95</span>, wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Brand Contribution to Revenue"</span>,</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.925</span>,</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Clearance status revenue by region"</span>,</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span>subtitle_col)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> grouped_df[<span class="st">'Region'</span>].unique()</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    region_data <span class="op">=</span> grouped_df[grouped_df[<span class="st">'Region'</span>] <span class="op">==</span> region]</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    brands       <span class="op">=</span> region_data[<span class="st">'Brand'</span>].cat.categories</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    clearance_yes   <span class="op">=</span> []</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    clearance_no    <span class="op">=</span> []</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> brand <span class="kw">in</span> brands:</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> region_data[region_data[<span class="st">'Brand'</span>] <span class="op">==</span> brand]</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>        yes_val <span class="op">=</span> data[data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>()</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>        no_val  <span class="op">=</span> data[data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>][<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>()</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>        clearance_yes.append(yes_val)</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>        clearance_no.append(no_val)</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    y_pos      <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(brands))</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>    bar_height <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>    bars_no <span class="op">=</span> ax.barh([y <span class="op">-</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos],</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>                      clearance_no, bar_height,</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>                      label<span class="op">=</span><span class="st">'No'</span>, color<span class="op">=</span>palette[<span class="st">'No'</span>])</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    bars_yes <span class="op">=</span> ax.barh([y <span class="op">+</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos],</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>                       clearance_yes, bar_height,</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">'Yes'</span>, color<span class="op">=</span>palette[<span class="st">'Yes'</span>])</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _add_labels(bars, offset):</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> bar.get_width()</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>                ax.text(width <span class="op">+</span> offset, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>                        <span class="ss">f"</span><span class="sc">{</span>width<span class="sc">:,.0f}</span><span class="ss">"</span>,      </span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>                        va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_col, fontweight<span class="op">=</span><span class="st">'bold'</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>    _add_labels(bars_no, <span class="bu">max</span>(clearance_no) <span class="op">*</span> <span class="fl">0.01</span> <span class="cf">if</span> clearance_no <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>    _add_labels(bars_yes, <span class="bu">max</span>(clearance_yes) <span class="op">*</span> <span class="fl">0.01</span> <span class="cf">if</span> clearance_yes <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(brands)</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Total Revenue'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>    ax.set_title(region, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>text_col, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x, _: <span class="ss">f"R </span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>      </span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelrotation<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>        ax.legend(title<span class="op">=</span><span class="st">'Clearance Sale'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="st">'Source: Dan – Faro'</span>,</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>caption_col)</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/brand-revenue-plot-output-1.png" id="brand-revenue-plot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div id="cell-category-revenue-plot" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> (</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    df_sales</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      .groupby([<span class="st">'Region'</span>, <span class="st">'Category'</span>, <span class="st">'ClearanceFlag'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>      .agg({<span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>,              </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>})</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>category_order <span class="op">=</span> (</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    grouped_df.groupby(<span class="st">'Category'</span>)[<span class="st">'RevenueFinal'</span>]   </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>              .<span class="bu">sum</span>()</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>              .sort_values()</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>              .index</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>              .tolist()</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>grouped_df[<span class="st">'Category'</span>] <span class="op">=</span> pd.Categorical(grouped_df[<span class="st">'Category'</span>],</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                                        categories<span class="op">=</span>category_order,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>                                        ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>palette        <span class="op">=</span> {<span class="st">"Yes"</span>: <span class="st">"#faca80"</span>, <span class="st">"No"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>highlight_col  <span class="op">=</span> <span class="st">"#faca80"</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>subtitle_col   <span class="op">=</span> <span class="st">"gray"</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>caption_col    <span class="op">=</span> <span class="st">"#666666"</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>text_col       <span class="op">=</span> <span class="st">"#151931"</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">9</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.85</span>, bottom<span class="op">=</span><span class="fl">0.15</span>, left<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>                    right<span class="op">=</span><span class="fl">0.95</span>, wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Category Contribution to Revenue"</span>,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.925</span>,</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Clearance status revenue by region"</span>,</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span>subtitle_col)</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> grouped_df[<span class="st">'Region'</span>].unique()</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    region_data <span class="op">=</span> grouped_df[grouped_df[<span class="st">'Region'</span>] <span class="op">==</span> region]</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    categories       <span class="op">=</span> region_data[<span class="st">'Category'</span>].cat.categories</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    clearance_yes   <span class="op">=</span> []</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>    clearance_no    <span class="op">=</span> []</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category <span class="kw">in</span> categories:</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> region_data[region_data[<span class="st">'Category'</span>] <span class="op">==</span> category]</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>        yes_val <span class="op">=</span> data[data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>()</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>        no_val  <span class="op">=</span> data[data[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>][<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>()</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>        clearance_yes.append(yes_val)</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>        clearance_no.append(no_val)</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>    y_pos      <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(categories))</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    bar_height <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>    bars_no <span class="op">=</span> ax.barh([y <span class="op">-</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos],</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>                      clearance_no, bar_height,</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>                      label<span class="op">=</span><span class="st">'No'</span>, color<span class="op">=</span>palette[<span class="st">'No'</span>])</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>    bars_yes <span class="op">=</span> ax.barh([y <span class="op">+</span> bar_height<span class="op">/</span><span class="dv">2</span> <span class="cf">for</span> y <span class="kw">in</span> y_pos],</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>                       clearance_yes, bar_height,</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">'Yes'</span>, color<span class="op">=</span>palette[<span class="st">'Yes'</span>])</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _add_labels(bars, offset):</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> bar.get_width()</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> width <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>                ax.text(width <span class="op">+</span> offset, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>                        <span class="ss">f"</span><span class="sc">{</span>width<span class="sc">:,.0f}</span><span class="ss">"</span>,      </span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>                        va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>text_col, fontweight<span class="op">=</span><span class="st">'bold'</span></span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>    _add_labels(bars_no, <span class="bu">max</span>(clearance_no) <span class="op">*</span> <span class="fl">0.01</span> <span class="cf">if</span> clearance_no <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>    _add_labels(bars_yes, <span class="bu">max</span>(clearance_yes) <span class="op">*</span> <span class="fl">0.01</span> <span class="cf">if</span> clearance_yes <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(categories)</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Total Revenue'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>    ax.set_title(region, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>text_col, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(</span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x, _: <span class="ss">f"R </span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>      </span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelrotation<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>        ax.legend(title<span class="op">=</span><span class="st">'Clearance Sale'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="st">'Source: Dan – Faro'</span>,</span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>caption_col)</span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/category-revenue-plot-output-1.png" id="category-revenue-plot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div id="revenue-made" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>revenue_by_category <span class="op">=</span> df_sales.groupby(<span class="st">'Category'</span>)[<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>revenue_by_brand <span class="op">=</span> df_sales.groupby(<span class="st">'Brand'</span>)[<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>revenue_by_supplier <span class="op">=</span> df_sales.groupby(<span class="st">'Supplier'</span>)[<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>category_revenue_df <span class="op">=</span> revenue_by_category.reset_index()</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>category_revenue_df.columns <span class="op">=</span> [<span class="st">'Category'</span>, <span class="st">'Revenue'</span>]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>brand_revenue_df <span class="op">=</span> revenue_by_brand.reset_index()</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>brand_revenue_df.columns <span class="op">=</span> [<span class="st">'Brand'</span>, <span class="st">'Revenue'</span>]</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>supplier_revenue_df <span class="op">=</span> revenue_by_supplier.reset_index()</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>supplier_revenue_df.columns <span class="op">=</span> [<span class="st">'Supplier'</span>, <span class="st">'Revenue'</span>]</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">TOP 5 Categories by Revenue:"</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (cat, rev) <span class="kw">in</span> <span class="bu">enumerate</span>(revenue_by_category.head().items(), <span class="dv">1</span>):</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">: R </span><span class="sc">{</span>rev<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">TOP 5 Brands by Revenue:"</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, rev) <span class="kw">in</span> <span class="bu">enumerate</span>(revenue_by_brand.head().items(), <span class="dv">1</span>):</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: R </span><span class="sc">{</span>rev<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">TOP 5 Suppliers by Revenue:"</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, rev) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_supplier.head().items(), <span class="dv">1</span>):</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: R </span><span class="sc">{</span>rev<span class="sc">:,.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
TOP 5 Categories by Revenue:
1. Kids: R 10,225,549.88
2. Apparel: R 10,210,762.89
3. Accessories: R 10,159,280.09
4. Footwear: R 10,110,418.12

TOP 5 Brands by Revenue:
1. Tommy Hilfiger: R 4,117,751.97
2. DKNY: R 4,116,944.23
3. Under Armour: R 4,111,537.65
4. Ralph Lauren: R 4,078,220.00
5. Adidas: R 4,072,014.76

TOP 5 Suppliers by Revenue:
1. Asos: R 66,762.00
2. Nordstrom: R 43,342.00
3. Bloomingdale's: R 42,764.00
4. Macy's: R 42,366.00
5. JD Sports: R 38,301.00</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Insights of Analysis">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights of Analysis
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>In all three regions (GP, KZN, WC),<code>Asos</code> is the top performer <em>supplier</em> selling the most units both on sales and at normal price. Thus generating also the most revenue.</li>
<li>Based on the number of units sold:
<ul>
<li>In GP, <code>Tommy Hilfiger</code> is the top <em>brand</em> selling the most units at normal prices and the second best on sales products.</li>
<li>In KZN, <code>Ralph Lauren</code> is the top <em>brand</em> selling the most units both on sales and at normal prices.</li>
<li>In WC, <code>Adidas</code> is the top <em>brand</em> selling the most units at normal price and <code>Ralph Lauren</code> is the top <em>brand</em> selling the most units on sales.</li>
<li><code>Tommy Hilfiger</code> is the top performer <em>brand</em> in <strong>units</strong> sold. Followed by <code>Ralph Lauren</code> and <code>Under Armour</code>.</li>
<li><code>Tommy Hilfiger</code> is the top performer <em>brand</em> in <strong>revenue</strong>. Followed by <code>DKNY</code> and <code>Under Armour</code>.</li>
</ul></li>
<li><code>Accessories</code> is the top performer <code>Category</code> followed by <code>Apparel</code> and <code>Kids</code> in <strong>units</strong> sold while <code>Kids</code>, <code>Apparel</code>, and <code>Accessories</code> are the top performers in <strong>revenue</strong>.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="iii.2.-discount-effect-on-top-brands-suppliers" class="level2">
<h2 class="anchored" data-anchor-id="iii.2.-discount-effect-on-top-brands-suppliers">III.2. Discount effect on top brands &amp; suppliers</h2>
<p><strong>Supplier Discount % and units sold</strong></p>
<div id="cell-supplier-discount-units-plot" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># discount data for scatter plot</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>discount_scatter_df <span class="op">=</span> df_sales[df_sales[<span class="st">'DiscountPercentage'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].sample(<span class="bu">min</span>(<span class="dv">5000</span>, <span class="bu">len</span>(df_sales[df_sales[<span class="st">'DiscountPercentage'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]))).copy()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># discount distribution</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>discount_dist_df <span class="op">=</span> df_sales[df_sales[<span class="st">'DiscountPercentage'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by Supplier</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>supplier_summary <span class="op">=</span> (</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    discount_dist_df.groupby(<span class="st">'Supplier'</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    .agg(TotalUnitsSold<span class="op">=</span>(<span class="st">'QuantityAbs'</span>, <span class="st">'sum'</span>), AvgDiscountPercent<span class="op">=</span>(<span class="st">'DiscountPercentage'</span>, <span class="st">'mean'</span>))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by Brand</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>brand_summary <span class="op">=</span> (</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    discount_dist_df.groupby(<span class="st">'Brand'</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    .agg(TotalUnitsSold<span class="op">=</span>(<span class="st">'QuantityAbs'</span>, <span class="st">'sum'</span>), AvgDiscountPercent<span class="op">=</span>(<span class="st">'DiscountPercentage'</span>, <span class="st">'mean'</span>))</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Select top 10 suppliers</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>top_suppliers <span class="op">=</span> supplier_summary.nlargest(<span class="dv">10</span>, <span class="st">'TotalUnitsSold'</span>)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Select top 10 brands</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>top_brands <span class="op">=</span> brand_summary.nlargest(<span class="dv">10</span>, <span class="st">'TotalUnitsSold'</span>)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>p_discount_scatter <span class="op">=</span> (</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>    ggplot(top_suppliers, aes(x<span class="op">=</span><span class="st">'AvgDiscountPercent'</span>, y<span class="op">=</span><span class="st">'TotalUnitsSold'</span>, label<span class="op">=</span><span class="st">'Supplier'</span>)) <span class="op">+</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    geom_point(color<span class="op">=</span><span class="st">'#faca80'</span>, size<span class="op">=</span><span class="dv">4</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    geom_text(nudge_y<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="dv">8</span>) <span class="op">+</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">'Top 7 Suppliers: Discount % vs. Units Sold'</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'Average Discount Percent'</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'Total Units Sold'</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>    theme_minimal() <span class="op">+</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>p_discount_scatter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supplier-discount-units-plot-output-1.png" id="supplier-discount-units-plot" width="576" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Supplier discount % and Units">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Supplier discount % and Units
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>Asos</code>, top performer supplier in units sold, has an average discount percentage of <strong>32.3%</strong>, whereas <code>Nordstrom</code> and <code>Bloomingda</code> have an average discount percentage of <strong>43.3%</strong> with a performance of more or less 42,000 units, same as <code>Macy's</code> with an average discount percentage of <strong>25%</strong>. Depicting how the discount percentage does not drive sales.</li>
</ul>
</div>
</div>
</section>
<section id="iii.3.-average-turnover-per-store" class="level2">
<h2 class="anchored" data-anchor-id="iii.3.-average-turnover-per-store">III.3. Average turnover per store</h2>
<p><strong>Turnover Statistics</strong></p>
<div id="avg-sales" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weekly sales per store (sales only)</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>weekly_sales <span class="op">=</span> df_sales.groupby([<span class="st">'StoreID'</span>, <span class="st">'WeekOfYear'</span>])[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>avg_weekly_turnover <span class="op">=</span> weekly_sales.groupby(<span class="st">'StoreID'</span>)[<span class="st">'QuantityAbs'</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Stores performance KPI:"</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Best performing store: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>index[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss"> units/week)"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Average weekly turnover across all stores: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>mean()<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Median weekly turnover: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>median()<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Standard deviation: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>std()<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 Stores by weekly turnover:"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (store, turnover) <span class="kw">in</span> <span class="bu">enumerate</span>(avg_weekly_turnover.head(<span class="dv">5</span>).items(), <span class="dv">1</span>):</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. Store </span><span class="sc">{</span>store<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>turnover<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Stores performance KPI:
-   Best performing store: S002 (1438.0 units/week)
-   Average weekly turnover across all stores: 1423.4 units/week
-   Median weekly turnover: 1423.8 units/week
-   Standard deviation: 8.5 units/week

Top 5 Stores by weekly turnover:
1. Store S002: 1438.0 units/week
2. Store S010: 1429.9 units/week
3. Store S003: 1428.4 units/week
4. Store S001: 1428.2 units/week
5. Store S009: 1426.5 units/week</code></pre>
</div>
</div>
<p><strong>Visualizations</strong></p>
<div id="cell-plot-top-stores" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>turnover_df <span class="op">=</span> avg_weekly_turnover.reset_index()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>turnover_df.columns <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'AvgWeeklyTurnover'</span>]</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>stores_df <span class="op">=</span> turnover_df.head(<span class="dv">10</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Stores Performance</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>p_avg_turnover <span class="op">=</span> (ggplot(stores_df, </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        aes(x<span class="op">=</span><span class="st">'reorder(StoreID, AvgWeeklyTurnover)'</span>, y<span class="op">=</span><span class="st">'AvgWeeklyTurnover'</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'#151931'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Average Weekly Turnover by Store'</span>, </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Store ID'</span>, </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Average Weekly Units Sold'</span>) <span class="op">+</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>)))</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>p_avg_turnover</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-top-stores-output-1.png" id="plot-top-stores" width="576" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Weekly trend</strong></p>
<div id="cell-store-week-trend" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>weekly_trend <span class="op">=</span> df_sales.groupby(<span class="st">'WeekOfYear'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>weekly_trend[<span class="st">'WeekOfYear'</span>] <span class="op">=</span> weekly_trend[<span class="st">'WeekOfYear'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>p_trend <span class="op">=</span> (ggplot(weekly_trend, aes(x<span class="op">=</span><span class="st">'WeekOfYear'</span>, y<span class="op">=</span><span class="st">'QuantityAbs'</span>)) <span class="op">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>       geom_line(color<span class="op">=</span><span class="st">'#faca80'</span>, size<span class="op">=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>       geom_point(color<span class="op">=</span><span class="st">'#151931'</span>, size<span class="op">=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>       labs(title<span class="op">=</span><span class="st">'Weekly Sales Trend Across All Stores'</span>, </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">'Week of Year'</span>, </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'Total Units Sold'</span>) <span class="op">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>       theme_minimal() <span class="op">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>       theme(figure_size<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>)))</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>p_trend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/store-week-trend-output-1.png" id="store-week-trend" width="960" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Stores Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stores Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>Stores</code> sell on average 1424 units per week and only varies by <strong>9</strong> units indicating they sell more or less the same quantity.</li>
<li><code>S002</code> is the best performing store with 1438 units per week compared to the average of 1424 units per week.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="iii.4.-clearance-impact" class="level2">
<h2 class="anchored" data-anchor-id="iii.4.-clearance-impact">III.4. Clearance Impact</h2>
<p><strong>Sales only</strong></p>
<div id="sales-plot-by-clearance" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>PALETTE <span class="op">=</span> {<span class="st">"No"</span>: <span class="st">"#faca80"</span>, <span class="st">"Yes"</span>: <span class="st">"#151931"</span>}</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>currency <span class="op">=</span> FuncFormatter(<span class="kw">lambda</span> x, _: <span class="ss">f"$</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quartile_table(df, group_col, value_col):</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> (df.groupby(group_col)[value_col]</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            .quantile([<span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>]).unstack())</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    q.columns <span class="op">=</span> [<span class="st">'Q1'</span>, <span class="st">'Median'</span>, <span class="st">'Q3'</span>]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q.reset_index()</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> annotate_quartiles(ax, stats, x_offset<span class="op">=</span><span class="fl">0.06</span>):</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xpos, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(stats.iterrows()):</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        ax.scatter(xpos, row.Median, s<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>                   facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'#151931'</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                   linewidth<span class="op">=</span><span class="fl">1.4</span>, zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        ax.text(xpos <span class="op">+</span> x_offset, row.Median,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Median: R </span><span class="sc">{</span>row<span class="sc">.</span>Median<span class="sc">:,.0f}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span><span class="st">'#151931'</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        ax.text(xpos <span class="op">-</span> x_offset, row.Q1,</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Q1: R </span><span class="sc">{</span>row<span class="sc">.</span>Q1<span class="sc">:,.0f}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'#151931'</span>)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        ax.text(xpos <span class="op">-</span> x_offset, row.Q3,</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Q3: R </span><span class="sc">{</span>row<span class="sc">.</span>Q3<span class="sc">:,.0f}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'#151931'</span>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clearance_plot(df, title):</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Half-eye (left-half violin) + boxplot + annotated quartiles."""</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"_half"</span>] <span class="op">=</span> <span class="va">True</span>  <span class="co"># dummy hue level for split violin</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use dummy palette for _half</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    dummy_palette <span class="op">=</span> {<span class="va">True</span>: <span class="st">"#b0b0b8"</span>}</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># half violin (left side)</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>    sns.violinplot(</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'ClearanceFlag'</span>, y<span class="op">=</span><span class="st">'RevenueFinal'</span>,</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">'_half'</span>,</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>        split<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>        bw_adjust<span class="op">=</span><span class="fl">.6</span>,</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>        cut<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span>dummy_palette,  </span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>        inner<span class="op">=</span><span class="va">None</span>, linewidth<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2oxplot on top, with correct PALETTE</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'ClearanceFlag'</span>, y<span class="op">=</span><span class="st">'RevenueFinal'</span>,</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">'ClearanceFlag'</span>, palette<span class="op">=</span>PALETTE,</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>, dodge<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="fl">.18</span>, fliersize<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>        boxprops<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">.9</span>}, ax<span class="op">=</span>ax</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate quartiles</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> quartile_table(df, <span class="st">'ClearanceFlag'</span>, <span class="st">'RevenueFinal'</span>)</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>    annotate_quartiles(ax, stats)</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final formatting</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="va">None</span>)</span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Revenue (per line)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels([<span class="st">'Regular Price'</span>, <span class="st">'Clearance'</span>],</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a>                       fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span><span class="st">'#151931'</span>)</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">14</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_major_formatter(currency)</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a>    sns.despine(left<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Build plots</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a>sales_df <span class="op">=</span> df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">0</span>].copy()</span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a>returns_df <span class="op">=</span> df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()   </span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a>fig_sales <span class="op">=</span> clearance_plot(</span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a>    sales_df,</span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sales&nbsp;Revenue Distribution by Clearance Status"</span></span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> returns_df.empty:</span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>    fig_returns <span class="op">=</span> clearance_plot(</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a>        returns_df,</span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Return&nbsp;Revenue Distribution by Clearance Status"</span></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/sales-plot-by-clearance-output-1.png" id="sales-plot-by-clearance-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/sales-plot-by-clearance-output-2.png" id="sales-plot-by-clearance-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="clearance-impact" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sales only</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>clearance_sales_analysis <span class="op">=</span> df_sales.groupby(<span class="st">'ClearanceFlag'</span>).agg({</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clearance vs Non-Clearance (Sales Only):"</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clearance_sales_analysis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Clearance vs Non-Clearance (Sales Only):
              QuantityAbs       RevenueFinal        
                      sum  mean          sum    mean
ClearanceFlag                                       
No                 227842  3.00  36373670.00  479.34
Yes                 56837  2.99   4332340.98  227.65</code></pre>
</div>
</div>
<p><strong>Returns and Sales</strong></p>
<div id="clearance-return-sales" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sales and returns transactions</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>clearance_return_analysis <span class="op">=</span> df.groupby(<span class="st">'ClearanceFlag'</span>).agg({</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'IsReturn'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sales and returns"</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clearance_return_analysis)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">RETURN ANALYSIS (All Transactions):"</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Non-Clearance:"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Return rate: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'No'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'mean'</span>)]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Total return transactions: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'No'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'sum'</span>)]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clearance:"</span>)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Return rate: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'mean'</span>)]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Total return transactions: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'sum'</span>)]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sales and returns
              IsReturn        RevenueFinal          QuantityAbs
                   sum   mean          sum     mean         sum
ClearanceFlag                                                  
No                4097  0.051  35380209.05  442.363      234025
Yes                989  0.049   4217442.73  210.661       58307

RETURN ANALYSIS (All Transactions):
Non-Clearance:
  - Return rate: 0.051
  - Total return transactions: 4,097
Clearance:
  - Return rate: 0.049
  - Total return transactions: 989</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Clearance Impact Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clearance Impact Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Faro has sold more items at normal price (227842 units for R36,373,670.00) than at discount price ( 56837 units for R4,332,340.98).</li>
<li>The return rates for items by their clearance status is roughly the same, 5.1% when sold at not price and 4.9% when sold at discounted price indicating that clearance does not impact the return.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="iii.5.-customer-behavior" class="level2">
<h2 class="anchored" data-anchor-id="iii.5.-customer-behavior">III.5. Customer behavior</h2>
<div id="customer-behavior" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>regional_sales_analysis <span class="op">=</span> df_sales.groupby(<span class="st">'Region'</span>).agg({</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CustomerID'</span>: <span class="st">'nunique'</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DiscountPercentage'</span>: <span class="st">'mean'</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TransactionID'</span>: <span class="st">'count'</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>regional_return_analysis <span class="op">=</span> df.groupby(<span class="st">'Region'</span>)[<span class="st">'IsReturn'</span>].mean()</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Regional Sales KPI:"</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regional_sales_analysis)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regional Returns KPI:"</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region, rate <span class="kw">in</span> regional_return_analysis.items():</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rate<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Regional Sales KPI:
       CustomerID QuantityAbs       RevenueFinal         DiscountPercentage  \
          nunique         sum  mean          sum    mean               mean   
Region                                                                        
GP          26751       95479  3.01  13650498.60  430.05              33.00   
KZN         26712       95226  3.00  13700240.18  431.31              32.74   
WC          26571       93974  2.99  13355272.20  425.22              32.88   

       TransactionID  
               count  
Region                
GP             31742  
KZN            31764  
WC             31408  

Regional Returns KPI:
GP: 0.051
KZN: 0.051
WC: 0.051</code></pre>
</div>
</div>
<p><strong>Regional metrics</strong></p>
<div id="customer-behavior-summary" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>regional_summary <span class="op">=</span> df_sales.groupby(<span class="st">'Region'</span>).agg({</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CustomerID'</span>: <span class="st">'nunique'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TransactionID'</span>: <span class="st">'count'</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>regional_summary[<span class="st">'TransactionsPerCustomer'</span>] <span class="op">=</span> regional_summary[<span class="st">'TransactionID'</span>] <span class="op">/</span> regional_summary[<span class="st">'CustomerID'</span>]</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>regional_summary[<span class="st">'RevenuePerCustomer'</span>] <span class="op">=</span> regional_summary[<span class="st">'RevenueFinal'</span>] <span class="op">/</span> regional_summary[<span class="st">'CustomerID'</span>]</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>regional_summary[<span class="st">'UnitsPerCustomer'</span>] <span class="op">=</span> regional_summary[<span class="st">'QuantityAbs'</span>] <span class="op">/</span> regional_summary[<span class="st">'CustomerID'</span>]</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add return rates</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>regional_summary <span class="op">=</span> regional_summary.merge(</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    regional_return_analysis.reset_index().rename(columns<span class="op">=</span>{<span class="st">'IsReturn'</span>: <span class="st">'ReturnRate'</span>}),</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'Region'</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Customer-based Regional KPI:"</span>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regional_summary[[<span class="st">'Region'</span>, <span class="st">'CustomerID'</span>, <span class="st">'TransactionsPerCustomer'</span>, <span class="st">'RevenuePerCustomer'</span>, <span class="st">'UnitsPerCustomer'</span>, <span class="st">'ReturnRate'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Customer-based Regional KPI:
  Region  CustomerID  TransactionsPerCustomer  RevenuePerCustomer  \
0     GP       26751                 1.186572          510.279937   
1    KZN       26712                 1.189128          512.887099   
2     WC       26571                 1.182041          502.625878   

   UnitsPerCustomer  ReturnRate  
0          3.569175    0.050721  
1          3.564915    0.050687  
2          3.536713    0.051175  </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Customer behavior Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Customer behavior Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>Regions</code> have roughly the same number of unique customers and generating the same revenue.</li>
<li><code>Regions</code> have the same number of returns items indicating that no particular region is underperforming.</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="iv.-predictive-modelling" class="level1">
<h1>IV. PREDICTIVE MODELLING</h1>
<p><strong>State of the dataset</strong></p>
<div id="state-of-the-dataset" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data types:"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Data types:
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 100000 entries, 0 to 99999
Data columns (total 24 columns):
 #   Column                 Non-Null Count   Dtype         
---  ------                 --------------   -----         
 0   TransactionID          100000 non-null  object        
 1   StoreID                100000 non-null  object        
 2   Date                   100000 non-null  datetime64[ns]
 3   ProductID              100000 non-null  object        
 4   Brand                  100000 non-null  object        
 5   Supplier               100000 non-null  object        
 6   Category               100000 non-null  object        
 7   Subcategory            100000 non-null  object        
 8   Type                   100000 non-null  object        
 9   OriginalPrice          100000 non-null  float64       
 10  CustomerID             100000 non-null  object        
 11  Region                 100000 non-null  object        
 12  ClearanceFlag          100000 non-null  object        
 13  QuantityAbs            100000 non-null  int64         
 14  IsReturn               100000 non-null  int32         
 15  TransactionType        100000 non-null  object        
 16  RevenueAbs             100000 non-null  float64       
 17  RevenueFinal           100000 non-null  float64       
 18  Year                   100000 non-null  int32         
 19  Month                  100000 non-null  int32         
 20  WeekOfYear             100000 non-null  UInt32        
 21  DayOfWeek              100000 non-null  int32         
 22  DiscountPercentage     100000 non-null  float64       
 23  DiscountedPriceBoxCox  100000 non-null  float64       
dtypes: UInt32(1), datetime64[ns](1), float64(5), int32(4), int64(1), object(12)
memory usage: 16.5+ MB</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>TransactionID</code> is not informative for the model because of high cardinality.</li>
<li><code>ProductID</code> is not informative for the model because of high cardinality.</li>
</ul>
</div>
</div>
<div id="drop-high-cardinality" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop([<span class="st">'TransactionID'</span>, <span class="st">'ProductID'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="iv.1.-target-feature" class="level2">
<h2 class="anchored" data-anchor-id="iv.1.-target-feature">IV.1. Target Feature</h2>
<p><code>ClearanceFlag</code> is the target feature of interest. We attempt to predict whether a product will be sold at clearance or at normal price. This will guide the marketing team to know when, how, and for which products to promote clearance sales to maximize revenue. It is, however, a tricky task as <strong>any</strong> product WILL definitely be sold at clearance.</p>
<p>Thus the goal is to penalize prediction of <code>Yes</code> when the product would have been sold at normal price.</p>
<div id="cell-ClearanceFlag-counts" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ClearanceFlag"</span>] <span class="op">=</span> (df[<span class="st">"ClearanceFlag"</span>] <span class="op">==</span> <span class="st">'Yes'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ClearanceFlag"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="clearanceflag-counts" class="cell-output cell-output-display" data-execution_count="39">
<pre><code>ClearanceFlag
0    79980
1    20020
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>A <strong>1:4</strong> ratio between <code>Yes</code> and <code>No</code> for clearance status displaying imbalance.</li>
</ul>
</div>
</div>
</section>
<section id="iv.2.-feature-selection" class="level2">
<h2 class="anchored" data-anchor-id="iv.2.-feature-selection">IV.2. Feature Selection</h2>
<p>Feature selection is a very important step in machine learning, just like the saying <code>garbage in, garbage out</code>, feeding the wrong features may negatively impact the model performance.</p>
<p>There are numerous way to select what features, recursive selection, mutual information, to more advanced methods making use of evolutionary algorithms such as particle swarm optimization or grey wolf.</p>
<p>In this project, we will follow a simple <code>mutual information(MI)</code>, a concept from information theory telling us how much we can learn from a feature if we know the value of of another.</p>
<p><strong>Goal:</strong> I first want to establish a baseline model without performing any advanced selection or engineering of features.</p>
<section id="numerical-and-categorical-features" class="level3">
<h3 class="anchored" data-anchor-id="numerical-and-categorical-features">Numerical and Categorical features</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" title="Feature selection">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Correlation for Numerical</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Mutual Information for Categorical</a></li></ul>
<div class="tab-content" title="Feature selection">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div id="cell-numerical-corr" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>numerical_cols <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>,<span class="st">'RevenueAbs'</span>, <span class="st">'RevenueFinal'</span>, <span class="st">'Month'</span>, <span class="st">'WeekOfYear'</span>, <span class="st">'DayOfWeek'</span>, <span class="st">'IsReturn'</span>,<span class="st">'DiscountPercentage'</span>,<span class="st">'DiscountedPriceBoxCox'</span>]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>df[numerical_cols].corrwith(df.ClearanceFlag).to_frame(<span class="st">'correlation'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="numerical-corr" class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">correlation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">OriginalPrice</td>
<td>0.002843</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">QuantityAbs</td>
<td>-0.003838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RevenueAbs</td>
<td>-0.474774</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RevenueFinal</td>
<td>-0.258259</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Month</td>
<td>-0.002561</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">WeekOfYear</td>
<td>-0.002215</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">DayOfWeek</td>
<td>-0.003218</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">IsReturn</td>
<td>-0.003323</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">DiscountPercentage</td>
<td>0.737020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">DiscountedPriceBoxCox</td>
<td>-0.253410</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>DiscountPercentage</code> has a <em>0.74</em> correlation with <code>ClearanceFlag</code> indicating that higher discount percentage likely to sell the product at clearance which is obvious. Maybe binning to find out what range of percentage is likely to sell at clearance.</li>
<li><code>RevenueAbs</code> (-0.47) and <code>RevenueFinal</code> (-0.25) indicate that when revenue increases, the item is unlikely to have been sold at clearance.</li>
<li>A high <code>DiscountedPrice</code> will reduce the likelihood of the item being sold at clearance. Maybe binning the feature for better interpretability and possibly improve model performance.</li>
</ul>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div id="cell-categorical-mi" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>,<span class="st">'TransactionType'</span>]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">### ----- Define the function to calculate the M.I on the training set ONLY</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_mi(series):</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mutual_info_score(series, df[<span class="st">"ClearanceFlag"</span>])</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">#### ---- Calculate MI between 'y' and the categorical variables of the training set ONLY </span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>df_mi <span class="op">=</span> df[categorical_cols].<span class="bu">apply</span>(calculate_mi)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>df_mi <span class="op">=</span> df_mi.sort_values(ascending<span class="op">=</span><span class="va">False</span>).to_frame(name<span class="op">=</span><span class="st">'MI'</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Below are the variable with highest M.I score:'</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>display(df_mi.head(<span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Below are the variable with highest M.I score:</code></pre>
</div>
<div id="categorical-mi" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Type</td>
<td>0.000251</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Subcategory</td>
<td>0.000068</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">StoreID</td>
<td>0.000067</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Region</td>
<td>0.000062</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Brand</td>
<td>0.000043</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Supplier</td>
<td>0.000020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Category</td>
<td>0.000010</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TransactionType</td>
<td>0.000006</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Knowing the <code>Type</code> of the product provides more information on whether or not it will be sold at clearance.</li>
<li><code>TransactionType</code> values are not very informative.</li>
<li><code>Brand</code>, <code>StoreID</code>, <code>Region</code>, and <code>Subcategory</code> values also provide valuable information on the target feature status. Maybe creating interaction between these categorical features might be helpful for a better generalization.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="base-model" class="level3">
<h3 class="anchored" data-anchor-id="base-model">Base model</h3>
<section id="select-features" class="level4">
<h4 class="anchored" data-anchor-id="select-features">1. Select features</h4>
<div id="feature-selection" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on correlation</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>selected_num <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>,<span class="st">'RevenueAbs'</span>, <span class="st">'RevenueFinal'</span>, <span class="st">'DiscountPercentage'</span>,<span class="st">'DiscountedPriceBoxCox'</span>]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on MI</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>selected_cat <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="split" class="level4">
<h4 class="anchored" data-anchor-id="split">2. Split</h4>
<div id="split-df" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>df_train_full, df_test <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>df_train, df_val <span class="op">=</span> train_test_split(df_train_full, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">## ---- Extract and create "ClearanceFlag" for the different splits</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_train[<span class="st">"ClearanceFlag"</span>].values</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> df_val[<span class="st">"ClearanceFlag"</span>].values</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> df_test[<span class="st">"ClearanceFlag"</span>].values</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co">### ------ Delete "ClearanceFlag"from the splits</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_train[<span class="st">'ClearanceFlag'</span>]</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_val[<span class="st">'ClearanceFlag'</span>]</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_test[<span class="st">'ClearanceFlag'</span>]</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training set: </span><span class="sc">{</span><span class="bu">len</span>(df_train)<span class="sc">}</span><span class="ss">, Validation set: </span><span class="sc">{</span><span class="bu">len</span>(df_val)<span class="sc">}</span><span class="ss"> , Test set: </span><span class="sc">{</span><span class="bu">len</span>(df_test)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training set: 60000, Validation set: 20000 , Test set: 20000</code></pre>
</div>
</div>
</section>
<section id="train-base-model" class="level4">
<h4 class="anchored" data-anchor-id="train-base-model">3. Train base model</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset" title="Base model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Base model with “Revenue”</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Base model with “Revenue” (without “Revenue”)</a></li></ul>
<div class="tab-content" title="Base model">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div id="base-model" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">## ----- Initialize the encoder: ------</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>dv <span class="op">=</span> DictVectorizer(sparse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">## ---- Apply the transformation on the training set</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>train_dict <span class="op">=</span> df_train[selected_num <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> dv.fit_transform(train_dict)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">## ---- Apply the transformation on the validation set (for evaluation)</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>val_dict <span class="op">=</span> df_val[selected_num <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> dv.transform(val_dict)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">#### Training on Logistic regression</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>, C<span class="op">=</span><span class="fl">1.0</span>, max_iter<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>class_weight<span class="op">=</span><span class="st">'balanced'</span>,random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on validation set</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_val, y_pred)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> precision_score(y_val, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)  </span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> recall_score(y_val, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Base logistic regression"</span>)</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Validation Accuracy : </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification report on baseline LR model:"</span>)</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Base logistic regression
Validation Accuracy : 1.0000
Classification report on baseline LR model:
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     16020
           1       1.00      1.00      1.00      3980

    accuracy                           1.00     20000
   macro avg       1.00      1.00      1.00     20000
weighted avg       1.00      1.00      1.00     20000
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Overfitting">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overfitting
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We noticed earlier a very high correlation between certain features to the clearance status. This results in a model learning for example that whenever DiscountPercentage is high, predict ClearanceFlag=Yes.</li>
<li>A feature like <code>Revenue</code> is a <em>target-leaking</em> feature as it was engineered based on the ClearanceFlag status. <strong>Solution:</strong> Drop any feature that is engineered from the target feature and observe the result.</li>
</ul>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div id="base-model-without-revenue" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>filtered_numerical_cols <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>, <span class="st">'Month'</span>, <span class="st">'WeekOfYear'</span>, <span class="st">'DayOfWeek'</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>selected_cat <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>, <span class="st">'IsReturn'</span>, <span class="st">'TransactionType'</span>]</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># DictVectorizer encoding</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>dv <span class="op">=</span> DictVectorizer(sparse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>train_dict <span class="op">=</span> df_train[filtered_numerical_cols <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> dv.fit_transform(train_dict)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># DictVectorizer encoding (val)</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>val_dict <span class="op">=</span> df_val[filtered_numerical_cols <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> dv.transform(val_dict)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Train logistic regression</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>, C<span class="op">=</span><span class="fl">1.0</span>, max_iter<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>class_weight<span class="op">=</span><span class="st">'balanced'</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on validation</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate performance</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_val, y_pred)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Logistic Regression (Leakage-Free Features)"</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Accuracy : </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression (Leakage-Free Features)
  Accuracy : 0.5130

Classification Report:
              precision    recall  f1-score   support

           0       0.80      0.52      0.63     16020
           1       0.20      0.49      0.28      3980

    accuracy                           0.51     20000
   macro avg       0.50      0.50      0.46     20000
weighted avg       0.68      0.51      0.56     20000
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>No overfitting, that is a good sign. But <em>underfitting</em>.</li>
<li>The base model never predicts class 1 (Clearance) as the accuracy is 80% which is also the percentage of observations that were sold at normal price.</li>
<li>Recall for class 1 = 0 indicating all actual clearance items are missed.</li>
<li>Precision for class 1 = 0 indicating when it predicts class 1 (which it doesn’t), it’s always wrong.</li>
<li>Macro avg: Treats both classes equally which exposes failure on class 1.</li>
<li>Weighted avg: Dominated by class 0 which looks better but hides the issue.</li>
</ul>
<p><strong>Possible solutions:</strong> - Introduce feature engineering and observe the results. - Try a sampling technique such oversampling or undersampling or SMOTE. - Use a tree-based models like decision tree.</p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="iv.3.-feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="iv.3.-feature-engineering">IV.3. Feature Engineering</h2>
<p>To enrich the features, we create new features to help the model learn better. The features will be created in the following groups:</p>
<ul>
<li>Temporal features:
<ul>
<li><code>IsWeekend</code>, <code>IsMonthEnd</code>, <code>IsMonthStart</code>, <code>IsPromotionSeason</code></li>
</ul></li>
<li>Price features:
<ul>
<li><code>DiscountCategory</code>, <code>DiscountedPriceCategory</code>, <code>PriceEfficiency</code></li>
</ul></li>
<li>Interaction features:
<ul>
<li><code>Region_Type</code>, <code>Region_Subcategory</code>, <code>Type_Subcategory</code>, <code>StoreID_Type</code>, <code>Supplier_Type</code>, etc</li>
<li><code>Supplier_return_rate</code>, <code>Brand_return_rate</code></li>
</ul></li>
</ul>
<p>After feature engineering, we will attempt to make the model more robust by trying out the following:</p>
<ul>
<li>Hyperparameter tuning</li>
<li>Smote</li>
<li>Oversampling</li>
<li>Undersampling</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>