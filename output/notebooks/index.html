<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dan A. Tshisungu">
<meta name="dcterms.date" content="2025-06-23">
<meta name="description" content="In this project, we attempt to provide insights on Faro and its retail business of discounted branded products.">

<title>Faro Off-Price Retail analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">1. Background</a></li>
  <li><a href="#data-cleaning-and-preparation" id="toc-data-cleaning-and-preparation" class="nav-link" data-scroll-target="#data-cleaning-and-preparation">2. Data Cleaning and preparation</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">2.1. Load data</a></li>
  <li><a href="#dataset-inspection" id="toc-dataset-inspection" class="nav-link" data-scroll-target="#dataset-inspection">2.1. Dataset Inspection</a></li>
  <li><a href="#data-quality-issues" id="toc-data-quality-issues" class="nav-link" data-scroll-target="#data-quality-issues">2.3. Data Quality issues</a>
  <ul class="collapse">
  <li><a href="#duplicate-values" id="toc-duplicate-values" class="nav-link" data-scroll-target="#duplicate-values">2.3.1. Duplicate values</a></li>
  <li><a href="#missing-value-analysis" id="toc-missing-value-analysis" class="nav-link" data-scroll-target="#missing-value-analysis">2.3.2. Missing value analysis</a></li>
  <li><a href="#distribution-analysis" id="toc-distribution-analysis" class="nav-link" data-scroll-target="#distribution-analysis">2.3.3. Distribution analysis</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">2.3.4. Data preparation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">3. Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#top-performing" id="toc-top-performing" class="nav-link" data-scroll-target="#top-performing">3.1. Top performing</a>
  <ul class="collapse">
  <li><a href="#a.-category-feature" id="toc-a.-category-feature" class="nav-link" data-scroll-target="#a.-category-feature">A. Category feature</a></li>
  <li><a href="#b.-supplier-feature" id="toc-b.-supplier-feature" class="nav-link" data-scroll-target="#b.-supplier-feature">B. Supplier feature</a></li>
  <li><a href="#c.-brand-feature" id="toc-c.-brand-feature" class="nav-link" data-scroll-target="#c.-brand-feature">C. Brand feature</a></li>
  </ul></li>
  <li><a href="#discount-effect-on-top-brands-suppliers" id="toc-discount-effect-on-top-brands-suppliers" class="nav-link" data-scroll-target="#discount-effect-on-top-brands-suppliers">3.2. Discount effect on top brands &amp; suppliers</a></li>
  <li><a href="#average-turnover" id="toc-average-turnover" class="nav-link" data-scroll-target="#average-turnover">3.3. Average turnover</a></li>
  <li><a href="#clearance-impact" id="toc-clearance-impact" class="nav-link" data-scroll-target="#clearance-impact">3.4. Clearance Impact</a></li>
  <li><a href="#customer-behavior" id="toc-customer-behavior" class="nav-link" data-scroll-target="#customer-behavior">3.5. Customer behavior</a></li>
  </ul></li>
  <li><a href="#predictive-task" id="toc-predictive-task" class="nav-link" data-scroll-target="#predictive-task">4. Predictive task</a>
  <ul class="collapse">
  <li><a href="#target-encoding" id="toc-target-encoding" class="nav-link" data-scroll-target="#target-encoding">4.1. Target encoding</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection">4.2. Feature Selection</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">4.3. Cross validation</a></li>
  <li><a href="#train" id="toc-train" class="nav-link" data-scroll-target="#train">4.4. Train</a>
  <ul class="collapse">
  <li><a href="#base-logistic-regression" id="toc-base-logistic-regression" class="nav-link" data-scroll-target="#base-logistic-regression">4.4.1. Base Logistic regression</a></li>
  <li><a href="#logistic-regression-with-class-weight" id="toc-logistic-regression-with-class-weight" class="nav-link" data-scroll-target="#logistic-regression-with-class-weight">4.4.2. Logistic regression with Class Weight</a></li>
  <li><a href="#decision-tree" id="toc-decision-tree" class="nav-link" data-scroll-target="#decision-tree">4.4.3. Decision tree</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Faro Off-Price Retail analytics</h1>
</div>

<div>
  <div class="description">
    In this project, we attempt to provide insights on Faro and its retail business of discounted branded products.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dan A. Tshisungu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 23, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="background" class="level1">
<h1>1. Background</h1>
<p>Faro, an off-price retailer that specialises in selling branded products at discounted prices. The business wants to understand which product types, brands, and<br>
suppliers move fastest, how pricing affects inventory turnover, and how customer shopping habits vary by region and time.</p>
</section>
<section id="data-cleaning-and-preparation" class="level1">
<h1>2. Data Cleaning and preparation</h1>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">2.1. Load data</h2>
<p>We load the dataset and display the first 10 transactions.</p>
<div id="data-loading" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> boxcox</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> skew</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PowerTransformer, QuantileTransformer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mutual_info_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction <span class="im">import</span> DictVectorizer</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, precision_score, recall_score, classification_report</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold, cross_validate</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.under_sampling <span class="im">import</span> RandomUnderSampler</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> RandomOverSampler</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lets_plot <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>LetsPlot.setup_html()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'../data/raw/offprice_transactions.csv'</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="data-loading-1" class="cell-output cell-output-display">

            <div id="B6VDAN"></div>
            <script type="text/javascript" data-lets-plot-script="library">
                if(!window.letsPlotCallQueue) {
                    window.letsPlotCallQueue = [];
                }; 
                window.letsPlotCall = function(f) {
                    window.letsPlotCallQueue.push(f);
                };
                (function() {
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = "https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js";
                    script.onload = function() {
                        window.letsPlotCall = function(f) {f();};
                        window.letsPlotCallQueue.forEach(function(f) {f();});
                        window.letsPlotCallQueue = [];
                        
                    };
                    script.onerror = function(event) {
                        window.letsPlotCall = function(f) {};    // noop
                        window.letsPlotCallQueue = [];
                        var div = document.createElement("div");
                        div.style.color = 'darkred';
                        div.textContent = 'Error loading Lets-Plot JS';
                        document.getElementById("B6VDAN").appendChild(div);
                    };
                    var e = document.getElementById("B6VDAN");
                    e.appendChild(script);
                })()
            </script>
            
</div>
<div id="data-loading-2" class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">DiscountedPrice</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">CustomerID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">ClearanceFlag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T100000</td>
<td>S008</td>
<td>2024-04-12</td>
<td>P4655</td>
<td>Puma</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sneakers</td>
<td>Lifestyle Sneakers</td>
<td>243.03</td>
<td>194.42</td>
<td>5</td>
<td>C18185</td>
<td>WC</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>T100001</td>
<td>S007</td>
<td>2024-04-12</td>
<td>P9119</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>144.83</td>
<td>130.35</td>
<td>5</td>
<td>C23031</td>
<td>KZN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>T100002</td>
<td>S008</td>
<td>2024-04-09</td>
<td>P4186</td>
<td>Puma</td>
<td>SoleSupplier</td>
<td>Kids</td>
<td>Girls</td>
<td>Dress</td>
<td>60.00</td>
<td>36.00</td>
<td>4</td>
<td>C82590</td>
<td>GP</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>T100003</td>
<td>S008</td>
<td>2024-02-07</td>
<td>P2999</td>
<td>Ralph Lauren</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>20.22</td>
<td>8.09</td>
<td>2</td>
<td>C57438</td>
<td>GP</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>T100004</td>
<td>S009</td>
<td>2024-01-22</td>
<td>P2853</td>
<td>Michael Kors</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>21.98</td>
<td>19.78</td>
<td>2</td>
<td>C60203</td>
<td>WC</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>T100005</td>
<td>S007</td>
<td>2024-01-15</td>
<td>P2858</td>
<td>DKNY</td>
<td>Bloomingdale's</td>
<td>Accessories</td>
<td>Belts</td>
<td>Canvas Belt</td>
<td>147.70</td>
<td>88.62</td>
<td>4</td>
<td>C27014</td>
<td>GP</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>T100006</td>
<td>S002</td>
<td>2024-03-04</td>
<td>P2632</td>
<td>Tommy Hilfiger</td>
<td>Nordstrom</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>150.69</td>
<td>75.34</td>
<td>1</td>
<td>C23775</td>
<td>GP</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>T100007</td>
<td>S004</td>
<td>2024-01-18</td>
<td>P6498</td>
<td>Adidas</td>
<td>JD Sports</td>
<td>Apparel</td>
<td>Bottoms</td>
<td>Jeans</td>
<td>285.69</td>
<td>114.28</td>
<td>1</td>
<td>C34075</td>
<td>WC</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>T100008</td>
<td>S004</td>
<td>2024-03-30</td>
<td>P1463</td>
<td>Adidas</td>
<td>JD Sports</td>
<td>Footwear</td>
<td>Boots</td>
<td>Chelsea Boots</td>
<td>47.35</td>
<td>28.41</td>
<td>4</td>
<td>C39283</td>
<td>GP</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>T100009</td>
<td>S007</td>
<td>2024-01-08</td>
<td>P2538</td>
<td>Under Armour</td>
<td>Asos</td>
<td>Accessories</td>
<td>Belts</td>
<td>Leather Belt</td>
<td>29.63</td>
<td>14.82</td>
<td>4</td>
<td>C15041</td>
<td>WC</td>
<td>Yes</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Below is the description of each feature:</p>
<ul>
<li><strong>TransactionID</strong>: Unique ID for each transaction</li>
<li><strong>StoreID</strong>: Store location identifier</li>
<li><strong>Date</strong>: Date of transaction</li>
<li><strong>ProductID</strong>: Unique product identifier</li>
<li><strong>Brand</strong>: Product brand</li>
<li><strong>Supplier</strong>: Supplier of the product</li>
<li><strong>Category</strong>: Top-level product category (e.g., Apparel, Footwear, Accessories, Kids)</li>
<li><strong>Subcategory</strong>: Second-level product classification (e.g., Tops, Boots, Bags, Boys)</li>
<li><strong>Type</strong>: Third-level, most granular product type (e.g., T-shirt, Sneakers, Clutch, Puzzle)</li>
<li><strong>OriginalPrice</strong>: Original list price</li>
<li><strong>DiscountedPrice</strong>: Actual sale price</li>
<li><strong>Quantity</strong>: Number of units sold (can be negative for returns)</li>
<li><strong>CustomerID</strong>: Encrypted customer ID</li>
<li><strong>Region</strong>: Store region (e.g., GP, WC, KZN)</li>
</ul>
</section>
<section id="dataset-inspection" class="level2">
<h2 class="anchored" data-anchor-id="dataset-inspection">2.1. Dataset Inspection</h2>
<p>We check the number of observations and features in the dataset.</p>
<div id="data-shape" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Our dataset has </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> transactions and </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> features."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Our dataset has 100000 transactions and 15 features.</code></pre>
</div>
</div>
<p><strong>Features types:</strong></p>
<p>We check the feature types to find out what feature may need conversion.</p>
<div id="cell-features-types" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="features-types" class="cell-output cell-output-display" data-execution_count="4">
<pre><code>TransactionID       object
StoreID             object
Date                object
ProductID           object
Brand               object
Supplier            object
Category            object
Subcategory         object
Type                object
OriginalPrice      float64
DiscountedPrice    float64
Quantity             int64
CustomerID          object
Region              object
ClearanceFlag       object
dtype: object</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Features Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Features Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>Date</code> feature has to be converted into a datetime feature, and temporal features (day, week, month) extracted from it.</li>
<li>Create <code>DiscountPercent</code> feature from the price features.</li>
<li>Create <code>Revenue</code> feature based on both <code>Price</code> and <code>Quantity</code>. Refer to <a href="#cau-revenue" class="quarto-xref">Caution&nbsp;1</a>.</li>
</ul>
</div>
</div>
</div>
<p><strong>Feature Information:</strong></p>
<div id="features-info" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 100000 entries, 0 to 99999
Data columns (total 15 columns):
 #   Column           Non-Null Count   Dtype  
---  ------           --------------   -----  
 0   TransactionID    100000 non-null  object 
 1   StoreID          100000 non-null  object 
 2   Date             100000 non-null  object 
 3   ProductID        100000 non-null  object 
 4   Brand            100000 non-null  object 
 5   Supplier         100000 non-null  object 
 6   Category         100000 non-null  object 
 7   Subcategory      100000 non-null  object 
 8   Type             100000 non-null  object 
 9   OriginalPrice    100000 non-null  float64
 10  DiscountedPrice  100000 non-null  float64
 11  Quantity         100000 non-null  int64  
 12  CustomerID       100000 non-null  object 
 13  Region           100000 non-null  object 
 14  ClearanceFlag    100000 non-null  object 
dtypes: float64(2), int64(1), object(12)
memory usage: 11.4+ MB</code></pre>
</div>
</div>
<div id="cau-revenue" class="callout callout-style-default callout-caution callout-titled" title="Revenue formula">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution&nbsp;1: Revenue formula
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Some products are sold at normal price while others are sold at a discounted price.<br>
Thus, the formula for the <code>Revenue</code> feature is:</p>
<p><span class="math display">\[
\text{Revenue} =
\begin{cases}
\text{Quantity} \times \text{OriginalPrice}, &amp; \text{if } \texttt{ClearanceFlag} = \texttt{No} \\
\text{Quantity} \times \text{DiscountedPrice}, &amp; \text{if } \texttt{ClearanceFlag} = \texttt{Yes}
\end{cases}
\]</span></p>
</div>
</div>
</div>
</section>
<section id="data-quality-issues" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-issues">2.3. Data Quality issues</h2>
<p>We now check any data quality issues:</p>
<ul>
<li>duplicate values</li>
<li>missing values</li>
<li>skewness of the distribution</li>
<li>outliers</li>
<li>incorrect feature formating etc</li>
</ul>
<section id="duplicate-values" class="level3">
<h3 class="anchored" data-anchor-id="duplicate-values">2.3.1. Duplicate values</h3>
<div id="cell-duplicate-check" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.duplicated().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="duplicate-check" class="cell-output cell-output-display" data-execution_count="6">
<pre><code>False</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Duplicate value Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Duplicate value Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are no duplicate value in the dataset.</p>
</div>
</div>
</section>
<section id="missing-value-analysis" class="level3">
<h3 class="anchored" data-anchor-id="missing-value-analysis">2.3.2. Missing value analysis</h3>
<p>Below we check the number of missing value for each feature:</p>
<div id="cell-missing-value" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="missing-value" class="cell-output cell-output-display" data-execution_count="7">
<pre><code>TransactionID      False
StoreID            False
Date               False
ProductID          False
Brand              False
Supplier           False
Category           False
Subcategory        False
Type               False
OriginalPrice      False
DiscountedPrice    False
Quantity           False
CustomerID         False
Region             False
ClearanceFlag      False
dtype: bool</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Missing Value Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Missing Value Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are no missing value in the dataset.</p>
</div>
</div>
</section>
<section id="distribution-analysis" class="level3">
<h3 class="anchored" data-anchor-id="distribution-analysis">2.3.3. Distribution analysis</h3>
<p>We check the distribution of both the numerical and categorical features. But first we extract numerical and categorical features.</p>
<div id="feature-type-extraction" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>numerical_columns <span class="op">=</span> df.select_dtypes(include<span class="op">=</span><span class="st">"number"</span>).columns.to_list()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> df.select_dtypes(exclude<span class="op">=</span><span class="st">"number"</span>).columns.to_list()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Numerical features in the dataset: </span><span class="sc">{</span>numerical_columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Categorical features in the dataset: </span><span class="sc">{</span>categorical_columns<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Numerical features in the dataset: ['OriginalPrice', 'DiscountedPrice', 'Quantity']
Categorical features in the dataset: ['TransactionID', 'StoreID', 'Date', 'ProductID', 'Brand', 'Supplier', 'Category', 'Subcategory', 'Type', 'CustomerID', 'Region', 'ClearanceFlag']</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Features Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Features Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember we have to convert the <code>Date</code> feature later on.</p>
</div>
</div>
<p><strong>A. Numerical features</strong></p>
<p><strong>Distribution of numerical features:</strong></p>
<div id="numerical-distribution" class="cell" data-execution_count="9">
<div id="lst-skewness" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored" data-code-fold="true">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-skewness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Skewness plot
</figcaption>
<div aria-describedby="lst-skewness-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract numerical features</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>numerical <span class="op">=</span> [<span class="st">"OriginalPrice"</span>, <span class="st">"DiscountedPrice"</span>, <span class="st">"Quantity"</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> numerical: </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract skewness</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Feature: </span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    skewness <span class="op">=</span> skew(df[feat])</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Skewness is </span><span class="sc">{</span>skewness<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate plot</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> (ggplot(df, aes(x<span class="op">=</span>feat)) <span class="op">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>         geom_density(color<span class="op">=</span><span class="st">'darkgreen'</span>, alpha<span class="op">=</span><span class="fl">.7</span>) <span class="op">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>         ggtitle(<span class="ss">f"Distribution of </span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss"> (Skewness: </span><span class="sc">{</span>skewness<span class="sc">:.2f}</span><span class="ss">)"</span>) <span class="op">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>         xlab(feat) <span class="op">+</span> ylab(<span class="st">"Density"</span>) <span class="op">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>         theme_minimal())</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Feature: OriginalPrice:
Skewness is -0.0028062700583212194
Feature: DiscountedPrice:
Skewness is 0.35201956858296896
Feature: Quantity:
Skewness is -0.576037618829498</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Numerical feature Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Numerical feature Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>OriginalPrice</code> feature is uniformly distributed meaning products are sold throughout the price range and no particular <code>OriginalPrice</code> is informative.</li>
<li><code>DiscountedPrice</code> feature is skewed to the right meaning most products are sold at a lower <code>DiscountedPrice</code>, up to <code>R140</code>, compared to higher prices, above <code>R150</code>.</li>
<li><code>Quantity</code> feature displays how products are not sold in no particular quantity.</li>
<li>We also observe one or two items returned every now and then, <code>5%</code> of the sales.</li>
</ul>
</div>
</div>
</div>
<p><strong>Statistical Measure of Numerical features</strong></p>
<div id="cell-numerical-stats" class="cell" data-execution_count="10">
<div id="lst-numerical-feature" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored" data-code-fold="true">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-numerical-feature-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;2: Numerical features description
</figcaption>
<div aria-describedby="lst-numerical-feature-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
<div id="numerical-stats" class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">DiscountedPrice</th>
<th data-quarto-table-cell-role="th">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>100000.000000</td>
<td>100000.000000</td>
<td>100000.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>160.068899</td>
<td>107.431994</td>
<td>2.770260</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>80.798129</td>
<td>59.216377</td>
<td>1.698319</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>20.010000</td>
<td>8.000000</td>
<td>-2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>89.720000</td>
<td>58.140000</td>
<td>2.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>160.180000</td>
<td>103.060000</td>
<td>3.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>230.060000</td>
<td>149.980000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>300.000000</td>
<td>270.000000</td>
<td>5.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>B. Categorical features</strong></p>
<p>We check the count of classes within each categorical feature:</p>
<div id="cell-categorical-stats" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="categorical-stats" class="cell-output cell-output-display" data-execution_count="11">
<pre><code>TransactionID      100000
StoreID                10
Date                  140
ProductID            9000
Brand                  10
Supplier                7
Category                4
Subcategory            16
Type                   51
OriginalPrice       27240
DiscountedPrice     22649
Quantity                7
CustomerID          60470
Region                  3
ClearanceFlag           2
dtype: int64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Categorical features Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Categorical features Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Some customers have multiple transactions, so <code>CustomerID</code> is not unique.</li>
<li>9000 unique products are sold</li>
<li>10 unique brands and stores</li>
<li>Products are bought in 7 different quantities, may need to investigate further for a correlation between quantity and price.</li>
<li>60470 unique customers, maybe investigate or cluster them based on their purchasing behavior.</li>
</ul>
</div>
</div>
</div>
<p><strong>Class count in each feature:</strong></p>
<div id="categorical-distribution" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> [<span class="st">"StoreID"</span>, <span class="st">"ProductID"</span>, <span class="st">"Brand"</span>, <span class="st">"Supplier"</span>, <span class="st">"Category"</span>, <span class="st">"Subcategory"</span>, <span class="st">"Type"</span>, <span class="st">"CustomerID"</span>, <span class="st">"Region"</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> categories:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> unique values: </span><span class="sc">{</span>df[col]<span class="sc">.</span>value_counts()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--"</span><span class="op">*</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>StoreID unique values: StoreID
S002    10102
S007    10066
S008    10037
S003    10036
S001    10014
S005     9987
S010     9973
S004     9954
S009     9950
S006     9881
Name: count, dtype: int64
----------------------------------------
ProductID unique values: ProductID
P2610    27
P1976    26
P7930    25
P2591    25
P1640    25
         ..
P9560     2
P6268     2
P6560     2
P1952     2
P6495     2
Name: count, Length: 9000, dtype: int64
----------------------------------------
Brand unique values: Brand
Tommy Hilfiger    10180
Ralph Lauren      10129
Under Armour      10119
Adidas            10002
Zara               9992
Michael Kors       9932
DKNY               9932
Puma               9918
Guess              9913
Nike               9883
Name: count, dtype: int64
----------------------------------------
Supplier unique values: Supplier
Asos              23446
Nordstrom         15197
Bloomingdale's    14981
Macy's            14867
JD Sports         13441
Inditex            9992
SoleSupplier       8076
Name: count, dtype: int64
----------------------------------------
Category unique values: Category
Accessories    25122
Apparel        25022
Kids           25007
Footwear       24849
Name: count, dtype: int64
----------------------------------------
Subcategory unique values: Subcategory
Hats         6469
Boys         6416
Tops         6336
Flats        6311
Belts        6291
Toys         6258
Boots        6256
Jewelry      6248
Dresses      6246
Bottoms      6232
Outerwear    6208
Sneakers     6174
Baby         6173
Girls        6160
Bags         6114
Sandals      6108
Name: count, dtype: int64
----------------------------------------
Type unique values: Type
Shorts                3654
T-shirt               3648
Loafers               2148
Sneakers              2142
Puzzle                2130
Espadrilles           2125
Elastic Belt          2122
Running Shoes         2120
Casual Dress          2114
Booties               2106
Bracelet              2105
Sandals               2105
Knee-high Boots       2102
Canvas Belt           2093
Ankle Boots           2084
Action Figure         2084
Evening Dress         2083
Earrings              2079
Leather Belt          2076
Dress                 2074
Flip Flops            2072
Chelsea Boots         2070
Necklace              2064
Basketball Shoes      2052
Maxi Dress            2049
Slides                2045
Plush Toy             2044
Onesie                2038
Ballet Flats          2038
Rompers               2029
Lifestyle Sneakers    2002
Gladiator Sandals     1991
Leggings              1981
Fedora                1646
Cap                   1635
Skirt                 1623
Tank Top              1619
Bucket Hat            1611
Blouse                1604
Shirt                 1590
Clutch                1585
Beanie                1577
Trousers              1569
Puffer                1561
Jacket                1560
Tote                  1550
Blazer                1544
Coat                  1543
Jeans                 1535
Satchel               1516
Backpack              1463
Name: count, dtype: int64
----------------------------------------
CustomerID unique values: CustomerID
C76591    9
C36989    8
C68230    8
C42539    8
C99455    7
         ..
C23917    1
C19435    1
C39164    1
C63404    1
C90467    1
Name: count, Length: 60470, dtype: int64
----------------------------------------
Region unique values: Region
KZN    33460
GP     33438
WC     33102
Name: count, dtype: int64
----------------------------------------</code></pre>
</div>
</div>
<p><strong>Statistical Measure of Categorical features</strong></p>
<p>We check a more summarized version of the features:</p>
<div id="cell-categorical-count" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.describe(exclude<span class="op">=</span><span class="st">"number"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="categorical-count" class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">CustomerID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">ClearanceFlag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
<td>100000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>100000</td>
<td>10</td>
<td>140</td>
<td>9000</td>
<td>10</td>
<td>7</td>
<td>4</td>
<td>16</td>
<td>51</td>
<td>60470</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>T100000</td>
<td>S002</td>
<td>2024-02-23</td>
<td>P2610</td>
<td>Tommy Hilfiger</td>
<td>Asos</td>
<td>Accessories</td>
<td>Hats</td>
<td>Shorts</td>
<td>C76591</td>
<td>KZN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>1</td>
<td>10102</td>
<td>776</td>
<td>27</td>
<td>10180</td>
<td>23446</td>
<td>25122</td>
<td>6469</td>
<td>3654</td>
<td>9</td>
<td>33460</td>
<td>79980</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Target feature : <code>ClearanceFlag</code></strong></p>
<div id="cell-target-variable" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ClearanceFlag"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="target-variable" class="cell-output cell-output-display" data-execution_count="14">
<pre><code>ClearanceFlag
No     79980
Yes    20020
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Target feature Insight">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Target feature Insight
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Out of 100000 items sold:</p>
<ul>
<li>79980, ~80%, were not on clearance sale</li>
<li>20020, ~20%, were on clearance sale</li>
<li>Stores sell mostly items at the normal rate.</li>
<li>A highly imbalanced dataset (1:4 ratio) for building a predictive model.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">2.3.4. Data preparation</h3>
<p><strong>A. Formatting features</strong></p>
<p>We convert the date feature in a datetime type, and we ensure numerical features are properly set.</p>
<div id="feature-formatting" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'OriginalPrice'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'OriginalPrice'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DiscountedPrice'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'DiscountedPrice'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Quantity'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'Quantity'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>B. Feature preparation</strong></p>
<p>At this stage <a href="#lst-numerical-feature" class="quarto-xref">Listing&nbsp;2</a>, we observed that the lowest of value of the <code>Quantity</code> feature is <strong>-2</strong>. We must take care of returned products as well create a <code>Revenue</code> <a href="#cau-revenue" class="quarto-xref">Caution&nbsp;1</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Features">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Features
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Every returned product was entered as a negative number. We create a new feature to describe if a product is return. e.g <code>IsReturn</code>.</li>
<li>Machine learning behave differently to the presence of negative numbers such as quantity = -1. We must consider both the business logic (A negative quantity means a return and thus an opportunity loss) and the model performance impact.</li>
</ul>
</div>
</div>
<div id="cell-return-feature" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Separate quantities and create indicators</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'QuantityAbs'</span>] <span class="op">=</span> df[<span class="st">'Quantity'</span>].<span class="bu">abs</span>()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify returns</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'IsReturn'</span>] <span class="op">=</span> (df[<span class="st">'Quantity'</span>] <span class="op">&lt;</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TransactionType'</span>] <span class="op">=</span> df[<span class="st">'Quantity'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Return'</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'Sale'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create revenue Revenue with proper handling</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'RevenueAbs'</span>] <span class="op">=</span> np.where(df[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                            df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'OriginalPrice'</span>],</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                            df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'DiscountedPrice'</span>])</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create final Revenue (negative for returns)</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'RevenueFinal'</span>] <span class="op">=</span> np.where(df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">1</span>, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                              <span class="op">-</span>df[<span class="st">'RevenueAbs'</span>], </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                              df[<span class="st">'RevenueAbs'</span>])</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Drop original Quantity if desired</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Quantity'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. create time-based features</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Year'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.year</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Month'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.month</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'WeekOfYear'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.isocalendar().week</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DayOfWeek'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.dayofweek</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Calculate discount percentage</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DiscountPercentage'</span>] <span class="op">=</span> ((df[<span class="st">'OriginalPrice'</span>] <span class="op">-</span> df[<span class="st">'DiscountedPrice'</span>]) <span class="op">/</span> df[<span class="st">'OriginalPrice'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="return-feature" class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">QuantityAbs</th>
<th data-quarto-table-cell-role="th">IsReturn</th>
<th data-quarto-table-cell-role="th">TransactionType</th>
<th data-quarto-table-cell-role="th">RevenueAbs</th>
<th data-quarto-table-cell-role="th">RevenueFinal</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">WeekOfYear</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">DiscountPercentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T100000</td>
<td>S008</td>
<td>2024-04-12</td>
<td>P4655</td>
<td>Puma</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sneakers</td>
<td>Lifestyle Sneakers</td>
<td>243.03</td>
<td>...</td>
<td>5</td>
<td>0</td>
<td>Sale</td>
<td>1215.15</td>
<td>1215.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>20.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>T100001</td>
<td>S007</td>
<td>2024-04-12</td>
<td>P9119</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>144.83</td>
<td>...</td>
<td>5</td>
<td>0</td>
<td>Sale</td>
<td>724.15</td>
<td>724.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>10.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>T100002</td>
<td>S008</td>
<td>2024-04-09</td>
<td>P4186</td>
<td>Puma</td>
<td>SoleSupplier</td>
<td>Kids</td>
<td>Girls</td>
<td>Dress</td>
<td>60.00</td>
<td>...</td>
<td>4</td>
<td>0</td>
<td>Sale</td>
<td>240.00</td>
<td>240.00</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>1</td>
<td>40.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>T100003</td>
<td>S008</td>
<td>2024-02-07</td>
<td>P2999</td>
<td>Ralph Lauren</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>20.22</td>
<td>...</td>
<td>2</td>
<td>0</td>
<td>Sale</td>
<td>16.18</td>
<td>16.18</td>
<td>2024</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>59.99</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>T100004</td>
<td>S009</td>
<td>2024-01-22</td>
<td>P2853</td>
<td>Michael Kors</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>21.98</td>
<td>...</td>
<td>2</td>
<td>0</td>
<td>Sale</td>
<td>43.96</td>
<td>43.96</td>
<td>2024</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>10.01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99995</td>
<td>T199995</td>
<td>S006</td>
<td>2024-03-13</td>
<td>P1324</td>
<td>Adidas</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>212.40</td>
<td>...</td>
<td>3</td>
<td>0</td>
<td>Sale</td>
<td>637.20</td>
<td>637.20</td>
<td>2024</td>
<td>3</td>
<td>11</td>
<td>2</td>
<td>10.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99996</td>
<td>T199996</td>
<td>S003</td>
<td>2024-02-11</td>
<td>P2084</td>
<td>Adidas</td>
<td>JD Sports</td>
<td>Apparel</td>
<td>Outerwear</td>
<td>Coat</td>
<td>56.19</td>
<td>...</td>
<td>4</td>
<td>0</td>
<td>Sale</td>
<td>224.76</td>
<td>224.76</td>
<td>2024</td>
<td>2</td>
<td>6</td>
<td>6</td>
<td>30.01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99997</td>
<td>T199997</td>
<td>S009</td>
<td>2024-04-03</td>
<td>P3564</td>
<td>Michael Kors</td>
<td>Nordstrom</td>
<td>Apparel</td>
<td>Dresses</td>
<td>Casual Dress</td>
<td>216.02</td>
<td>...</td>
<td>4</td>
<td>0</td>
<td>Sale</td>
<td>864.08</td>
<td>864.08</td>
<td>2024</td>
<td>4</td>
<td>14</td>
<td>2</td>
<td>40.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99998</td>
<td>T199998</td>
<td>S003</td>
<td>2024-02-14</td>
<td>P3085</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>166.14</td>
<td>...</td>
<td>5</td>
<td>0</td>
<td>Sale</td>
<td>830.70</td>
<td>830.70</td>
<td>2024</td>
<td>2</td>
<td>7</td>
<td>2</td>
<td>20.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99999</td>
<td>T199999</td>
<td>S005</td>
<td>2024-03-29</td>
<td>P3182</td>
<td>Zara</td>
<td>Inditex</td>
<td>Footwear</td>
<td>Boots</td>
<td>Knee-high Boots</td>
<td>223.12</td>
<td>...</td>
<td>3</td>
<td>0</td>
<td>Sale</td>
<td>267.75</td>
<td>267.75</td>
<td>2024</td>
<td>3</td>
<td>13</td>
<td>4</td>
<td>60.00</td>
</tr>
</tbody>
</table>

<p>100000 rows  24 columns</p>
</div>
</div>
</div>
<p><strong>C. Outlier Analysis</strong></p>
<p>We observed <a href="#lst-skewness" class="quarto-xref">Listing&nbsp;1</a> that <code>DiscountedPrice</code> is skewed to the right indicating the presence of outliers.</p>
<p>There are many ways to detect outliers:</p>
<ul>
<li>By calculating the skewness of the distribution and establishing a threshold</li>
<li>By visualizing the distribution of features</li>
<li>And more advanced methods more outlier detection</li>
<li>Using the IQR for the feature.</li>
</ul>
<p>Above <a href="#lst-skewness" class="quarto-xref">Listing&nbsp;1</a> we applied the first two. We can confirm that with the last method:</p>
<p>For <code>DiscountedPrice</code>, we have:</p>
<ul>
<li>min = 8</li>
<li>25% = 58</li>
<li>50% = 103</li>
<li>75% = 149.98</li>
<li>100% = 270</li>
</ul>
<p>By finding the difference between each interval, we can deduce from where outliers occur:</p>
<ul>
<li>25% - min = 50</li>
<li>50% - 25% = 45</li>
<li>75% - 50% = 46</li>
<li>100% - 75%= <code>120</code></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Outliers Insight">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Outliers Insight
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We notice a jump from 75th percentile to the 100th depicting outliers.</li>
<li>75th percentile + 50 = ~200. Anything above <code>200</code> in the <code>DiscountedPrice</code> is an outlier.</li>
<li>Though a mild skewness (0.35) is observed, we will attempt to deal with it.</li>
</ul>
</div>
</div>
<p><strong>Experiment with methods</strong></p>
<div id="outlier-analysis" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>transformations <span class="op">=</span> {}</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Original</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'Original'</span>] <span class="op">=</span> df[<span class="st">'DiscountedPrice'</span>]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Log transformation</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'Log'</span>] <span class="op">=</span> np.log1p(df[<span class="st">'DiscountedPrice'</span>])</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Square root</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'Sqrt'</span>] <span class="op">=</span> np.sqrt(df[<span class="st">'DiscountedPrice'</span>])</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Box-Cox</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'BoxCox'</span>], _ <span class="op">=</span> boxcox(df[<span class="st">'DiscountedPrice'</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Yeo-Johnson</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>pt <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'yeo-johnson'</span>, standardize<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>transformations[<span class="st">'YeoJohnson'</span>] <span class="op">=</span> pt.fit_transform(df[[<span class="st">'DiscountedPrice'</span>]]).flatten()</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare skewness</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> transformations.items():</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    skew_val <span class="op">=</span> stats.skew(data)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    results.append({<span class="st">'Transformation'</span>: name, <span class="st">'Skewness'</span>: skew_val})</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_df.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the best transformation (closest to 0)</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>best_transform <span class="op">=</span> comparison_df.loc[comparison_df[<span class="st">'Skewness'</span>].<span class="bu">abs</span>().idxmin(), <span class="st">'Transformation'</span>]</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best transformation: </span><span class="sc">{</span>best_transform<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transformation  Skewness
0       Original     0.352
1            Log    -0.781
2           Sqrt    -0.176
3         BoxCox    -0.116
4     YeoJohnson    -0.116

Best transformation: BoxCox</code></pre>
</div>
</div>
<p><strong>Final implementation</strong></p>
<div id="cell-final-implementation" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Box-Cox and store the Lambda value </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DiscountedPriceBoxCox'</span>], lambda_val <span class="op">=</span> boxcox(df[<span class="st">'DiscountedPrice'</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop original column</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'DiscountedPrice'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Update your revenue calculation with transformed prices</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'RevenueAbs'</span>] <span class="op">=</span> np.where(df[<span class="st">'ClearanceFlag'</span>] <span class="op">==</span> <span class="st">'No'</span>, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                           df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'OriginalPrice'</span>],</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                           df[<span class="st">'QuantityAbs'</span>] <span class="op">*</span> df[<span class="st">'DiscountedPriceBoxCox'</span>])</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"New skewness: </span><span class="sc">{</span>stats<span class="sc">.</span>skew(df[<span class="st">'DiscountedPriceBoxCox'</span>])<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>New skewness: -0.116</code></pre>
</div>
<div id="final-implementation" class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionID</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">IsReturn</th>
<th data-quarto-table-cell-role="th">TransactionType</th>
<th data-quarto-table-cell-role="th">RevenueAbs</th>
<th data-quarto-table-cell-role="th">RevenueFinal</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">WeekOfYear</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">DiscountPercentage</th>
<th data-quarto-table-cell-role="th">DiscountedPriceBoxCox</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>T100000</td>
<td>S008</td>
<td>2024-04-12</td>
<td>P4655</td>
<td>Puma</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sneakers</td>
<td>Lifestyle Sneakers</td>
<td>243.03</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>1215.150000</td>
<td>1215.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>20.00</td>
<td>30.868606</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>T100001</td>
<td>S007</td>
<td>2024-04-12</td>
<td>P9119</td>
<td>Nike</td>
<td>Asos</td>
<td>Kids</td>
<td>Baby</td>
<td>Booties</td>
<td>144.83</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>724.150000</td>
<td>724.15</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>4</td>
<td>10.00</td>
<td>24.486402</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>T100002</td>
<td>S008</td>
<td>2024-04-09</td>
<td>P4186</td>
<td>Puma</td>
<td>SoleSupplier</td>
<td>Kids</td>
<td>Girls</td>
<td>Dress</td>
<td>60.00</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>240.000000</td>
<td>240.00</td>
<td>2024</td>
<td>4</td>
<td>15</td>
<td>1</td>
<td>40.00</td>
<td>11.337297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>T100003</td>
<td>S008</td>
<td>2024-02-07</td>
<td>P2999</td>
<td>Ralph Lauren</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>20.22</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>8.567399</td>
<td>16.18</td>
<td>2024</td>
<td>2</td>
<td>6</td>
<td>2</td>
<td>59.99</td>
<td>4.283699</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>T100004</td>
<td>S009</td>
<td>2024-01-22</td>
<td>P2853</td>
<td>Michael Kors</td>
<td>Bloomingdale's</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>21.98</td>
<td>...</td>
<td>0</td>
<td>Sale</td>
<td>43.960000</td>
<td>43.96</td>
<td>2024</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>10.01</td>
<td>7.776294</td>
</tr>
</tbody>
</table>

<p>5 rows  24 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Summary of Data Preparation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary of Data Preparation
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We loaded our dataset and check its observations and features</li>
<li>We made sure there were no missing values nor any duplicated values</li>
<li>We created new features to enrich our dataset and make it more consistent for further analysis.</li>
<li>We converted <code>Date</code> and transformed the <code>DiscountedPrice</code> feature to handle the format for the former and outliers for the latter.</li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>3. Exploratory Data Analysis</h1>
<p>We explore the dataset in depth and answer business questions.</p>
<p>Let us have a look at the updated datasets features:</p>
<div id="cell-final-implementation-columns" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="final-implementation-columns" class="cell-output cell-output-display" data-execution_count="19">
<pre><code>Index(['TransactionID', 'StoreID', 'Date', 'ProductID', 'Brand', 'Supplier',
       'Category', 'Subcategory', 'Type', 'OriginalPrice', 'CustomerID',
       'Region', 'ClearanceFlag', 'QuantityAbs', 'IsReturn', 'TransactionType',
       'RevenueAbs', 'RevenueFinal', 'Year', 'Month', 'WeekOfYear',
       'DayOfWeek', 'DiscountPercentage', 'DiscountedPriceBoxCox'],
      dtype='object')</code></pre>
</div>
</div>
<p><strong>Sales information</strong></p>
<div id="data-overview" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sales transactions: </span><span class="sc">{</span>df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">0</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Return transactions: </span><span class="sc">{</span>df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">1</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Return rate: </span><span class="sc">{</span>df[<span class="st">'IsReturn'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sales transactions: 94,914
Return transactions: 5,086
Return rate: 0.051</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Sales Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sales Insights
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>Sales</code> account for ~ 94.5% of all transactions while <code>returns</code> for ~ 5.1%.</li>
</ul>
</div>
</div>
<section id="top-performing" class="level2">
<h2 class="anchored" data-anchor-id="top-performing">3.1. Top performing</h2>
<p>Because we focus on units sold and revenue, we filter to only use items that were not returned.</p>
<div id="data-filter" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_sales <span class="op">=</span> df[df[<span class="st">'IsReturn'</span>] <span class="op">==</span> <span class="dv">0</span>].copy()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Analyzing </span><span class="sc">{</span>df_sales<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> sales transactions (excluding returns)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Analyzing 94,914 sales transactions (excluding returns)</code></pre>
</div>
</div>
<section id="a.-category-feature" class="level3">
<h3 class="anchored" data-anchor-id="a.-category-feature">A. Category feature</h3>
<p><strong>Units Sold Analysis (Sales Only)</strong></p>
<div id="units-sold" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>units_by_category <span class="op">=</span> df_sales.groupby(<span class="st">'Category'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>units_by_brand <span class="op">=</span> df_sales.groupby(<span class="st">'Brand'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>units_by_supplier <span class="op">=</span> df_sales.groupby(<span class="st">'Supplier'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>category_units_df <span class="op">=</span> units_by_category.reset_index()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>category_units_df.columns <span class="op">=</span> [<span class="st">'Category'</span>, <span class="st">'Units'</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>brand_units_df <span class="op">=</span> units_by_brand.reset_index()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>brand_units_df.columns <span class="op">=</span> [<span class="st">'Brand'</span>, <span class="st">'Units'</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>supplier_units_df <span class="op">=</span> units_by_supplier.reset_index()</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>supplier_units_df.columns <span class="op">=</span> [<span class="st">'Supplier'</span>, <span class="st">'Units'</span>]</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 5 Categories by units sold:"</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (cat, units) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_category.head().items(), <span class="dv">1</span>):</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>units<span class="sc">:,}</span><span class="ss"> units"</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 Brands by units sold:"</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, units) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_brand.head().items(), <span class="dv">1</span>):</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>units<span class="sc">:,}</span><span class="ss"> units"</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 Suppliers by units sold:"</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, units) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_supplier.head().items(), <span class="dv">1</span>):</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>units<span class="sc">:,}</span><span class="ss"> units"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 Categories by units sold:
1. Accessories: 71,445 units
2. Apparel: 71,300 units
3. Kids: 71,154 units
4. Footwear: 70,780 units

Top 5 Brands by units sold:
1. Tommy Hilfiger: 28,915 units
2. Ralph Lauren: 28,840 units
3. Under Armour: 28,739 units
4. Adidas: 28,542 units
5. DKNY: 28,408 units

Top 5 Suppliers by units sold:
1. Asos: 66,762 units
2. Nordstrom: 43,342 units
3. Bloomingdale's: 42,764 units
4. Macy's: 42,366 units
5. JD Sports: 38,301 units</code></pre>
</div>
</div>
<p><strong>Revenue Generated Analysis (Sales Only)</strong></p>
<div id="revenue-made" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>revenue_by_category <span class="op">=</span> df_sales.groupby(<span class="st">'Category'</span>)[<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>revenue_by_brand <span class="op">=</span> df_sales.groupby(<span class="st">'Brand'</span>)[<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>revenue_by_supplier <span class="op">=</span> df_sales.groupby(<span class="st">'Supplier'</span>)[<span class="st">'RevenueFinal'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>category_revenue_df <span class="op">=</span> revenue_by_category.reset_index()</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>category_revenue_df.columns <span class="op">=</span> [<span class="st">'Category'</span>, <span class="st">'Revenue'</span>]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>brand_revenue_df <span class="op">=</span> revenue_by_brand.reset_index()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>brand_revenue_df.columns <span class="op">=</span> [<span class="st">'Brand'</span>, <span class="st">'Revenue'</span>]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>supplier_revenue_df <span class="op">=</span> revenue_by_supplier.reset_index()</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>supplier_revenue_df.columns <span class="op">=</span> [<span class="st">'Supplier'</span>, <span class="st">'Revenue'</span>]</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">TOP 5 Categories by Revenue:"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (cat, rev) <span class="kw">in</span> <span class="bu">enumerate</span>(revenue_by_category.head().items(), <span class="dv">1</span>):</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">: R </span><span class="sc">{</span>rev<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">TOP 5 Brands by Revenue:"</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, rev) <span class="kw">in</span> <span class="bu">enumerate</span>(revenue_by_brand.head().items(), <span class="dv">1</span>):</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: R </span><span class="sc">{</span>rev<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">TOP 5 Suppliers by Revenue:"</span>)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (brand, rev) <span class="kw">in</span> <span class="bu">enumerate</span>(units_by_supplier.head().items(), <span class="dv">1</span>):</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>brand<span class="sc">}</span><span class="ss">: R </span><span class="sc">{</span>rev<span class="sc">:,.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
TOP 5 Categories by Revenue:
1. Kids: R 10,225,549.88
2. Apparel: R 10,210,762.89
3. Accessories: R 10,159,280.09
4. Footwear: R 10,110,418.12

TOP 5 Brands by Revenue:
1. Tommy Hilfiger: R 4,117,751.97
2. DKNY: R 4,116,944.23
3. Under Armour: R 4,111,537.65
4. Ralph Lauren: R 4,078,220.00
5. Adidas: R 4,072,014.76

TOP 5 Suppliers by Revenue:
1. Asos: R 66,762.00
2. Nordstrom: R 43,342.00
3. Bloomingdale's: R 42,764.00
4. Macy's: R 42,366.00
5. JD Sports: R 38,301.00</code></pre>
</div>
</div>
<div id="cell-category-units" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> (ggplot(category_units_df, aes(x<span class="op">=</span><span class="st">'reorder(Category, Units)'</span>, y<span class="op">=</span><span class="st">'Units'</span>)) <span class="op">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'skyblue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Units Sold by Category'</span>, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Category'</span>, </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Units Sold'</span>) <span class="op">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/category-units-output-1.png" id="category-units" width="576" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-category-revenue" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> (ggplot(category_revenue_df, aes(x<span class="op">=</span><span class="st">'reorder(Category, Revenue)'</span>, y<span class="op">=</span><span class="st">'Revenue'</span>)) <span class="op">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'lightcoral'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Revenue by Category'</span>, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Category'</span>, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Revenue (R)'</span>) <span class="op">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/category-revenue-output-1.png" id="category-revenue" width="576" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Category feature Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Category feature Insights
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>Category</code> selling the most units does not always mean more revenue.</li>
<li><strong>accessories</strong> category have been sold the most but <strong>kids</strong> category generated the most.</li>
<li>Category have sold more or less the same quantity and generated more or less the same revenue, no major runner.</li>
</ul>
</div>
</div>
</section>
<section id="b.-supplier-feature" class="level3">
<h3 class="anchored" data-anchor-id="b.-supplier-feature">B. Supplier feature</h3>
<div id="cell-supplier-units" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> (ggplot(supplier_units_df, aes(x<span class="op">=</span><span class="st">'reorder(Supplier, Units)'</span>, y<span class="op">=</span><span class="st">'Units'</span>)) <span class="op">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'skyblue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Units Sold by Supplier'</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Supplier'</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Units Sold'</span>) <span class="op">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supplier-units-output-1.png" id="supplier-units" width="576" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-supplier-revenue" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> (ggplot(supplier_revenue_df, aes(x<span class="op">=</span><span class="st">'reorder(Supplier, Revenue)'</span>, y<span class="op">=</span><span class="st">'Revenue'</span>)) <span class="op">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'lightcoral'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Revenue by Supplier'</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Supplier'</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Revenue (R)'</span>) <span class="op">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)))</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>p4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supplier-revenue-output-1.png" id="supplier-revenue" width="576" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Supplier feature Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Supplier feature Insights
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Asos</strong> largely sold the most units and generated the most revenue.</li>
<li>Followed by <strong>Nordstrom</strong>, <strong>Bloomingdales</strong>, and <strong>Macys</strong> which sold more or less the same quantity of units and generated more or less the same amount.</li>
</ul>
</div>
</div>
</section>
<section id="c.-brand-feature" class="level3">
<h3 class="anchored" data-anchor-id="c.-brand-feature">C. Brand feature</h3>
<div id="cell-brand-units" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>p5 <span class="op">=</span> (ggplot(brand_units_df, aes(x<span class="op">=</span><span class="st">'reorder(Brand, Units)'</span>, y<span class="op">=</span><span class="st">'Units'</span>)) <span class="op">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'skyblue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Units Sold by Brand'</span>, </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Brand'</span>, </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Units Sold'</span>) <span class="op">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>p5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/brand-units-output-1.png" id="brand-units" width="576" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-brand-revenue" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>p6 <span class="op">=</span> (ggplot(brand_revenue_df, aes(x<span class="op">=</span><span class="st">'reorder(Brand, Revenue)'</span>, y<span class="op">=</span><span class="st">'Revenue'</span>)) <span class="op">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'lightcoral'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Revenue by Brand'</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Brand'</span>, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Revenue (R)'</span>) <span class="op">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>p6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/brand-revenue-output-1.png" id="brand-revenue" width="576" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Brand feature Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Brand feature Insights
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Tommy Hilfiger</strong> is the op selling brand in both units and revenue, followed by <strong>DKNY</strong> in revenue but 3rd in units sold.</li>
<li>Note that most brand have sold more than 28000 units and have all generated more than R4,000,000.00.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="discount-effect-on-top-brands-suppliers" class="level2">
<h2 class="anchored" data-anchor-id="discount-effect-on-top-brands-suppliers">3.2. Discount effect on top brands &amp; suppliers</h2>
<p>Find top brands and suppliers</p>
<div id="top-brand-supplier" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top brands &amp; suppliers</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>top_brands <span class="op">=</span> units_by_brand.head(<span class="dv">10</span>).index.tolist()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>top_suppliers <span class="op">=</span> units_by_supplier.head(<span class="dv">10</span>).index.tolist()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract data from sales based on top performing</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>discount_brand_data <span class="op">=</span> df_sales[df_sales[<span class="st">'Brand'</span>].isin(top_brands)].copy()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>discount_supplier_data <span class="op">=</span> df_sales[df_sales[<span class="st">'Supplier'</span>].isin(top_suppliers)].copy()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># summary for discounted or not</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>discount_summary <span class="op">=</span> df_sales.groupby(<span class="st">'ClearanceFlag'</span>).agg({</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DiscountPercentage'</span>: <span class="st">'mean'</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># discount data for scatter plot</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>discount_scatter_df <span class="op">=</span> df_sales[df_sales[<span class="st">'DiscountPercentage'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].sample(<span class="bu">min</span>(<span class="dv">5000</span>, <span class="bu">len</span>(df_sales[df_sales[<span class="st">'DiscountPercentage'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]))).copy()</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="co"># discount distribution</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>discount_dist_df <span class="op">=</span> df_sales[df_sales[<span class="st">'DiscountPercentage'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Discount Impact Summary:"</span>)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Without Discount:"</span>)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Average units per transaction: </span><span class="sc">{</span>discount_summary<span class="sc">.</span>loc[<span class="st">'No'</span>, (<span class="st">'QuantityAbs'</span>, <span class="st">'mean'</span>)]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Total units sold: </span><span class="sc">{</span>discount_summary<span class="sc">.</span>loc[<span class="st">'No'</span>, (<span class="st">'QuantityAbs'</span>, <span class="st">'sum'</span>)]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"With Discount:"</span>)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Average units per transaction: </span><span class="sc">{</span>discount_summary<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'QuantityAbs'</span>, <span class="st">'mean'</span>)]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Total units sold: </span><span class="sc">{</span>discount_summary<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'QuantityAbs'</span>, <span class="st">'sum'</span>)]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Average discount percentage: </span><span class="sc">{</span>discount_summary<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'DiscountPercentage'</span>, <span class="st">'mean'</span>)]<span class="sc">:.1f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Discount Impact Summary:
Without Discount:
  - Average units per transaction: 3.00
  - Total units sold: 227,842
With Discount:
  - Average units per transaction: 2.99
  - Total units sold: 56,837
  - Average discount percentage: 52.5%</code></pre>
</div>
</div>
<div id="cell-discount-distribution-plot" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of discount</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>p7 <span class="op">=</span> (ggplot(discount_dist_df, aes(x<span class="op">=</span><span class="st">'DiscountPercentage'</span>)) <span class="op">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>      geom_histogram(bins<span class="op">=</span><span class="dv">30</span>, fill<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Distribution of Discount Percentages'</span>, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Discount Percentage (%)'</span>, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Frequency'</span>) <span class="op">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">3</span>)))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>p7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/discount-distribution-plot-output-1.png" id="discount-distribution-plot" width="480" height="288" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Brand Discount % and units sold</strong></p>
<div id="cell-brand-discount-units-plot" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by Brand</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>brand_summary <span class="op">=</span> (</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    discount_dist_df.groupby(<span class="st">'Brand'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    .agg(TotalUnitsSold<span class="op">=</span>(<span class="st">'QuantityAbs'</span>, <span class="st">'sum'</span>), AvgDiscountPercent<span class="op">=</span>(<span class="st">'DiscountPercentage'</span>, <span class="st">'mean'</span>))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Select top 10 brands</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>top_brands <span class="op">=</span> brand_summary.nlargest(<span class="dv">10</span>, <span class="st">'TotalUnitsSold'</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>p8 <span class="op">=</span> (</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    ggplot(top_brands, aes(x<span class="op">=</span><span class="st">'AvgDiscountPercent'</span>, y<span class="op">=</span><span class="st">'TotalUnitsSold'</span>, label<span class="op">=</span><span class="st">'Brand'</span>)) <span class="op">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    geom_point(color<span class="op">=</span><span class="st">'dodgerblue'</span>, size<span class="op">=</span><span class="dv">4</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    geom_text(nudge_y<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="dv">8</span>) <span class="op">+</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">'Top 10 Brands: Discount % vs. Units Sold'</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'Average Discount Percent'</span>,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'Total Units Sold'</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    theme_minimal() <span class="op">+</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>p8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/brand-discount-units-plot-output-1.png" id="brand-discount-units-plot" width="576" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Brand discount % and Units">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Brand discount % and Units
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>Tommy Hilfiger</code> has sold the most units with an average discount while <code>Ralph Lauren</code> is second best with highest discount percentage.</li>
<li>We also note that <code>Zara</code>, <code>Nike</code>, and <code>Under Amour</code> have the same average discount percentage but have a large disparity in the number of units sold.</li>
</ul>
</div>
</div>
<p><strong>Supplier Discount % and units sold</strong></p>
<div id="cell-supplier-discount-units-plot" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by Supplier</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>supplier_summary <span class="op">=</span> (</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    discount_dist_df.groupby(<span class="st">'Supplier'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    .agg(TotalUnitsSold<span class="op">=</span>(<span class="st">'QuantityAbs'</span>, <span class="st">'sum'</span>), AvgDiscountPercent<span class="op">=</span>(<span class="st">'DiscountPercentage'</span>, <span class="st">'mean'</span>))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Select top 10 suppliers</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>top_suppliers <span class="op">=</span> supplier_summary.nlargest(<span class="dv">10</span>, <span class="st">'TotalUnitsSold'</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Select top 10 brands</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>top_brands <span class="op">=</span> brand_summary.nlargest(<span class="dv">10</span>, <span class="st">'TotalUnitsSold'</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>p9 <span class="op">=</span> (</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    ggplot(top_suppliers, aes(x<span class="op">=</span><span class="st">'AvgDiscountPercent'</span>, y<span class="op">=</span><span class="st">'TotalUnitsSold'</span>, label<span class="op">=</span><span class="st">'Supplier'</span>)) <span class="op">+</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    geom_point(color<span class="op">=</span><span class="st">'forestgreen'</span>, size<span class="op">=</span><span class="dv">4</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    geom_text(nudge_y<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="dv">8</span>) <span class="op">+</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">'Top 10 Suppliers: Discount % vs. Units Sold'</span>,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'Average Discount Percent'</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'Total Units Sold'</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    theme_minimal() <span class="op">+</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>p9</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supplier-discount-units-plot-output-1.png" id="supplier-discount-units-plot" width="576" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Supplier discount % and Units">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Supplier discount % and Units
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>Macy's</code>, <code>Nordstrom</code>, and <code>Bloomingda</code> have sold almost the same number of units but the two latter have a very high discount percentage compared to the first.</li>
<li>Discount percentage does not drive sales.</li>
</ul>
</div>
</div>
<p><strong>Top Brand discount analysis</strong></p>
<div id="cell-brand-discount-analysis" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>brand_discount_summary <span class="op">=</span> discount_brand_data.groupby([<span class="st">'Brand'</span>, <span class="st">'ClearanceFlag'</span>]).agg({</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>p9 <span class="op">=</span> (ggplot(brand_discount_summary, aes(x<span class="op">=</span><span class="st">'Brand'</span>, y<span class="op">=</span><span class="st">'QuantityAbs'</span>, fill<span class="op">=</span><span class="st">'ClearanceFlag'</span>)) <span class="op">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      geom_col(position<span class="op">=</span><span class="st">'dodge'</span>) <span class="op">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Sales Volume: Discounted vs Non-Discounted (Top 10 Brands)'</span>, </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Brand'</span>, </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Units Sold'</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>           fill<span class="op">=</span><span class="st">'Discount Applied'</span>) <span class="op">+</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="fl">6.5</span>, <span class="dv">6</span>)))</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>p9</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/brand-discount-analysis-output-1.png" id="brand-discount-analysis" width="624" height="576" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Top Supplier discount analysis</strong></p>
<div id="cell-supplier-discount-analysis" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>supplier_discount_summary <span class="op">=</span> discount_supplier_data.groupby([<span class="st">'Supplier'</span>, <span class="st">'ClearanceFlag'</span>]).agg({</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>p10 <span class="op">=</span> (ggplot(supplier_discount_summary, aes(x<span class="op">=</span><span class="st">'Supplier'</span>, y<span class="op">=</span><span class="st">'QuantityAbs'</span>, fill<span class="op">=</span><span class="st">'ClearanceFlag'</span>)) <span class="op">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>      geom_col(position<span class="op">=</span><span class="st">'dodge'</span>) <span class="op">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Sales Volume: Discounted vs Non-Discounted (Top 7 Supplier)'</span>, </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Supplier'</span>, </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Total Units Sold'</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>           fill<span class="op">=</span><span class="st">'Discount Applied'</span>) <span class="op">+</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="fl">6.5</span>, <span class="dv">5</span>)))</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>p10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/supplier-discount-analysis-output-1.png" id="supplier-discount-analysis" width="624" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Discount Insights">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Discount Insights
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>discount percentage</code> is normally distributed around a 30% discount for products indicating that most discounted units are sold at an average discount, thus when a brand or supplier sells a lot, it is not based on the discount applied.</li>
<li><strong>Asos</strong> has the most units sold with and without discount applied. - <code>Brands</code> tend to sell same volume of discounted units ( ~ 4800).</li>
</ul>
</div>
</div>
</section>
<section id="average-turnover" class="level2">
<h2 class="anchored" data-anchor-id="average-turnover">3.3. Average turnover</h2>
<div id="avg-sales" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weekly sales per store (sales only)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>weekly_sales <span class="op">=</span> df_sales.groupby([<span class="st">'StoreID'</span>, <span class="st">'WeekOfYear'</span>])[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>avg_weekly_turnover <span class="op">=</span> weekly_sales.groupby(<span class="st">'StoreID'</span>)[<span class="st">'QuantityAbs'</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Stores performance KPI:"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Best performing store: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>index[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss"> units/week)"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Average weekly turnover across all stores: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>mean()<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Median weekly turnover: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>median()<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"-   Standard deviation: </span><span class="sc">{</span>avg_weekly_turnover<span class="sc">.</span>std()<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 Stores by weekly turnover:"</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (store, turnover) <span class="kw">in</span> <span class="bu">enumerate</span>(avg_weekly_turnover.head(<span class="dv">5</span>).items(), <span class="dv">1</span>):</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. Store </span><span class="sc">{</span>store<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>turnover<span class="sc">:.1f}</span><span class="ss"> units/week"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Stores performance KPI:
-   Best performing store: S002 (1438.0 units/week)
-   Average weekly turnover across all stores: 1423.4 units/week
-   Median weekly turnover: 1423.8 units/week
-   Standard deviation: 8.5 units/week

Top 5 Stores by weekly turnover:
1. Store S002: 1438.0 units/week
2. Store S010: 1429.9 units/week
3. Store S003: 1428.4 units/week
4. Store S001: 1428.2 units/week
5. Store S009: 1426.5 units/week</code></pre>
</div>
</div>
<p>Now we check some plots</p>
<div id="cell-plot-stores-sales" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for store analysis</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>turnover_df <span class="op">=</span> avg_weekly_turnover.reset_index()</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>turnover_df.columns <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'AvgWeeklyTurnover'</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>p11 <span class="op">=</span> (ggplot(turnover_df, aes(x<span class="op">=</span><span class="st">'AvgWeeklyTurnover'</span>)) <span class="op">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>      geom_histogram(bins<span class="op">=</span><span class="dv">30</span>, fill<span class="op">=</span><span class="st">'purple'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Distribution of Average Weekly Turnover by Store'</span>, </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Average Weekly Units Sold'</span>, </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Number of Stores'</span>) <span class="op">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>)))</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>p11</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-stores-sales-output-1.png" id="plot-stores-sales" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-plot-top-stores" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>stores_df <span class="op">=</span> turnover_df.head(<span class="dv">10</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Stores Performance</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>p12 <span class="op">=</span> (ggplot(stores_df, aes(x<span class="op">=</span><span class="st">'reorder(StoreID, AvgWeeklyTurnover)'</span>, y<span class="op">=</span><span class="st">'AvgWeeklyTurnover'</span>)) <span class="op">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>      geom_col(fill<span class="op">=</span><span class="st">'teal'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      coord_flip() <span class="op">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>      labs(title<span class="op">=</span><span class="st">'Stores by Average Weekly Turnover'</span>, </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span><span class="st">'Store ID'</span>, </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>           y<span class="op">=</span><span class="st">'Average Weekly Units Sold'</span>) <span class="op">+</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>      theme_minimal() <span class="op">+</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>      theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>)))</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>p12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-top-stores-output-1.png" id="plot-top-stores" width="576" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Weekly trend</strong></p>
<div id="cell-store-week-trend" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>weekly_trend <span class="op">=</span> df_sales.groupby(<span class="st">'WeekOfYear'</span>)[<span class="st">'QuantityAbs'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>weekly_trend[<span class="st">'WeekOfYear'</span>] <span class="op">=</span> weekly_trend[<span class="st">'WeekOfYear'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>p13 <span class="op">=</span> (ggplot(weekly_trend, aes(x<span class="op">=</span><span class="st">'WeekOfYear'</span>, y<span class="op">=</span><span class="st">'QuantityAbs'</span>)) <span class="op">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>       geom_line(color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>       geom_point(color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>       labs(title<span class="op">=</span><span class="st">'Weekly Sales Trend Across All Stores'</span>, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">'Week of Year'</span>, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'Total Units Sold'</span>) <span class="op">+</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>       theme_minimal() <span class="op">+</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>       theme(figure_size<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>)))</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>p13</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/store-week-trend-output-1.png" id="store-week-trend" width="1152" height="576" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Stores Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stores Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>Stores</code> sell on average 1424 units per week and only varies by <strong>8</strong> units indicating they sell more or less the same quantity.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="clearance-impact" class="level2">
<h2 class="anchored" data-anchor-id="clearance-impact">3.4. Clearance Impact</h2>
<p><strong>Sales only</strong></p>
<div id="clearance-impact" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sales only</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>clearance_sales_analysis <span class="op">=</span> df_sales.groupby(<span class="st">'ClearanceFlag'</span>).agg({</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clearance vs Non-Clearance (Sales Only):"</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clearance_sales_analysis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Clearance vs Non-Clearance (Sales Only):
              QuantityAbs       RevenueFinal        
                      sum  mean          sum    mean
ClearanceFlag                                       
No                 227842  3.00  36373670.00  479.34
Yes                 56837  2.99   4332340.98  227.65</code></pre>
</div>
</div>
<p><strong>Returns and Sales</strong></p>
<div id="clearance-return-sales" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sales and returns transactions</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>clearance_return_analysis <span class="op">=</span> df.groupby(<span class="st">'ClearanceFlag'</span>).agg({</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'IsReturn'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sales and returns"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clearance_return_analysis)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">RETURN ANALYSIS (All Transactions):"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Non-Clearance:"</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Return rate: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'No'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'mean'</span>)]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Total return transactions: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'No'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'sum'</span>)]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clearance:"</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Return rate: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'mean'</span>)]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Total return transactions: </span><span class="sc">{</span>clearance_return_analysis<span class="sc">.</span>loc[<span class="st">'Yes'</span>, (<span class="st">'IsReturn'</span>, <span class="st">'sum'</span>)]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sales and returns
              IsReturn        RevenueFinal          QuantityAbs
                   sum   mean          sum     mean         sum
ClearanceFlag                                                  
No                4097  0.051  35380209.05  442.363      234025
Yes                989  0.049   4217442.73  210.661       58307

RETURN ANALYSIS (All Transactions):
Non-Clearance:
  - Return rate: 0.051
  - Total return transactions: 4,097
Clearance:
  - Return rate: 0.049
  - Total return transactions: 989</code></pre>
</div>
</div>
<p><strong>Visualising clearances</strong></p>
<div id="cell-clearance-return-sales-plots" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>clearance_sales_summary <span class="op">=</span> df_sales.groupby(<span class="st">'ClearanceFlag'</span>).agg({</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>clearance_sales_summary.columns <span class="op">=</span> [<span class="st">'ClearanceFlag'</span>, <span class="st">'TotalUnits'</span>, <span class="st">'TotalRevenue'</span>, <span class="st">'AvgRevenue'</span>]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>clearance_sales_summary[<span class="st">'ClearanceStatus'</span>] <span class="op">=</span> clearance_sales_summary[<span class="st">'ClearanceFlag'</span>].<span class="bu">map</span>({<span class="va">False</span>: <span class="st">'Non-Clearance'</span>, <span class="va">True</span>: <span class="st">'Clearance'</span>})</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>return_rates <span class="op">=</span> df.groupby(<span class="st">'ClearanceFlag'</span>)[<span class="st">'IsReturn'</span>].mean().reset_index()</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>return_rates[<span class="st">'ClearanceStatus'</span>] <span class="op">=</span> return_rates[<span class="st">'ClearanceFlag'</span>].<span class="bu">map</span>({<span class="va">False</span>: <span class="st">'Non-Clearance'</span>, <span class="va">True</span>: <span class="st">'Clearance'</span>})</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>p16 <span class="op">=</span> (ggplot(df_sales, aes(x<span class="op">=</span><span class="st">'factor(ClearanceFlag)'</span>, y<span class="op">=</span><span class="st">'RevenueFinal'</span>)) <span class="op">+</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>       geom_boxplot(fill<span class="op">=</span>[<span class="st">'lightblue'</span>, <span class="st">'lightcoral'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>       labs(title<span class="op">=</span><span class="st">'Revenue Distribution by Clearance Status'</span>, </span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">'Clearance Status'</span>, </span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'Revenue per Transaction'</span>) <span class="op">+</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>       theme_minimal() <span class="op">+</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>       theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>)))</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clearance vs Non-Clearance"</span>)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>p16</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Clearance vs Non-Clearance</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/clearance-return-sales-plots-output-2.png" id="clearance-return-sales-plots" width="768" height="576" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Clearance Impact Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clearance Impact Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Faro has sold more items at normal price (227842 units for R36,373,670.00) than at discount price ( 56837 units for R4,332,340.98).</li>
<li>The return rates for items by their clearance status is roughly the same, 5.1% when sold at not price and 4.9% when sold at discounted price indicating that clearance does not impact the return.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="customer-behavior" class="level2">
<h2 class="anchored" data-anchor-id="customer-behavior">3.5. Customer behavior</h2>
<div id="customer-behavior" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>regional_sales_analysis <span class="op">=</span> df_sales.groupby(<span class="st">'Region'</span>).agg({</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CustomerID'</span>: <span class="st">'nunique'</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: [<span class="st">'sum'</span>, <span class="st">'mean'</span>],</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DiscountPercentage'</span>: <span class="st">'mean'</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TransactionID'</span>: <span class="st">'count'</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>}).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>regional_return_analysis <span class="op">=</span> df.groupby(<span class="st">'Region'</span>)[<span class="st">'IsReturn'</span>].mean()</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Regional Sales KPI:"</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regional_sales_analysis)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regional Returns KPI:"</span>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region, rate <span class="kw">in</span> regional_return_analysis.items():</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rate<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Regional Sales KPI:
       CustomerID QuantityAbs       RevenueFinal         DiscountPercentage  \
          nunique         sum  mean          sum    mean               mean   
Region                                                                        
GP          26751       95479  3.01  13650498.60  430.05              33.00   
KZN         26712       95226  3.00  13700240.18  431.31              32.74   
WC          26571       93974  2.99  13355272.20  425.22              32.88   

       TransactionID  
               count  
Region                
GP             31742  
KZN            31764  
WC             31408  

Regional Returns KPI:
GP: 0.051
KZN: 0.051
WC: 0.051</code></pre>
</div>
</div>
<p><strong>Regional metrics</strong></p>
<div id="customer-behavior-summary" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>regional_summary <span class="op">=</span> df_sales.groupby(<span class="st">'Region'</span>).agg({</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CustomerID'</span>: <span class="st">'nunique'</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TransactionID'</span>: <span class="st">'count'</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RevenueFinal'</span>: <span class="st">'sum'</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'QuantityAbs'</span>: <span class="st">'sum'</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>regional_summary[<span class="st">'TransactionsPerCustomer'</span>] <span class="op">=</span> regional_summary[<span class="st">'TransactionID'</span>] <span class="op">/</span> regional_summary[<span class="st">'CustomerID'</span>]</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>regional_summary[<span class="st">'RevenuePerCustomer'</span>] <span class="op">=</span> regional_summary[<span class="st">'RevenueFinal'</span>] <span class="op">/</span> regional_summary[<span class="st">'CustomerID'</span>]</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>regional_summary[<span class="st">'UnitsPerCustomer'</span>] <span class="op">=</span> regional_summary[<span class="st">'QuantityAbs'</span>] <span class="op">/</span> regional_summary[<span class="st">'CustomerID'</span>]</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add return rates</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>regional_summary <span class="op">=</span> regional_summary.merge(</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    regional_return_analysis.reset_index().rename(columns<span class="op">=</span>{<span class="st">'IsReturn'</span>: <span class="st">'ReturnRate'</span>}),</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'Region'</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Customer-based Regional KPI:"</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regional_summary[[<span class="st">'Region'</span>, <span class="st">'CustomerID'</span>, <span class="st">'TransactionsPerCustomer'</span>, <span class="st">'RevenuePerCustomer'</span>, <span class="st">'UnitsPerCustomer'</span>, <span class="st">'ReturnRate'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Customer-based Regional KPI:
  Region  CustomerID  TransactionsPerCustomer  RevenuePerCustomer  \
0     GP       26751                 1.186572          510.279937   
1    KZN       26712                 1.189128          512.887099   
2     WC       26571                 1.182041          502.625878   

   UnitsPerCustomer  ReturnRate  
0          3.569175    0.050721  
1          3.564915    0.050687  
2          3.536713    0.051175  </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Customer behavior Insights">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Customer behavior Insights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><code>Regions</code> have roughly the same number of unique customers and generating the same revenue.</li>
<li><code>Regions</code> have the same number of returns items indicating that no particular region is underperforming.</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="predictive-task" class="level1">
<h1>4. Predictive task</h1>
<p>The goal is to predict whether a given product will be sold on clearance or not.</p>
<div id="current-data" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 100000 entries, 0 to 99999
Data columns (total 24 columns):
 #   Column                 Non-Null Count   Dtype         
---  ------                 --------------   -----         
 0   TransactionID          100000 non-null  object        
 1   StoreID                100000 non-null  object        
 2   Date                   100000 non-null  datetime64[ns]
 3   ProductID              100000 non-null  object        
 4   Brand                  100000 non-null  object        
 5   Supplier               100000 non-null  object        
 6   Category               100000 non-null  object        
 7   Subcategory            100000 non-null  object        
 8   Type                   100000 non-null  object        
 9   OriginalPrice          100000 non-null  float64       
 10  CustomerID             100000 non-null  object        
 11  Region                 100000 non-null  object        
 12  ClearanceFlag          100000 non-null  object        
 13  QuantityAbs            100000 non-null  int64         
 14  IsReturn               100000 non-null  int32         
 15  TransactionType        100000 non-null  object        
 16  RevenueAbs             100000 non-null  float64       
 17  RevenueFinal           100000 non-null  float64       
 18  Year                   100000 non-null  int32         
 19  Month                  100000 non-null  int32         
 20  WeekOfYear             100000 non-null  UInt32        
 21  DayOfWeek              100000 non-null  int32         
 22  DiscountPercentage     100000 non-null  float64       
 23  DiscountedPriceBoxCox  100000 non-null  float64       
dtypes: UInt32(1), datetime64[ns](1), float64(5), int32(4), int64(1), object(12)
memory usage: 16.5+ MB</code></pre>
</div>
</div>
<section id="target-encoding" class="level2">
<h2 class="anchored" data-anchor-id="target-encoding">4.1. Target encoding</h2>
<div id="target-encoding" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Target feature into Integer</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ClearanceFlag"</span>] <span class="op">=</span> (df[<span class="st">"ClearanceFlag"</span>] <span class="op">==</span> <span class="st">'Yes'</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="feature-selection" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection">4.2. Feature Selection</h2>
<p>Feature selection is a very important step in machine learning, just like the saying <code>garbage in, garbage out</code>, feeding the wrong features may negatively impact the model performance.</p>
<p>There are numerous way to select what features, recursive selection, mutual information, to more advanced methods making use of evolutionary algorithms such as particle swarm optimization or grey wolf.</p>
<p>In this project, we will follow a simple <code>mutual information(MI)</code>, a concept from information theory telling us how much we can learn from a feature if we know the value of of another.</p>
<p><strong>Data Splitting</strong></p>
<div id="cell-data-splitting" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>df_train_full, df_test <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>df_train, df_val <span class="op">=</span> train_test_split(df_train_full, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df_train),<span class="bu">len</span>(df_val),<span class="bu">len</span>(df_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="data-splitting" class="cell-output cell-output-display" data-execution_count="47">
<pre><code>(60000, 20000, 20000)</code></pre>
</div>
</div>
<p><strong>Remove target feature</strong></p>
<div id="remove-target" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ---- Extract and create "ClearanceFlag" for the different splits</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_train[<span class="st">"ClearanceFlag"</span>].values</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> df_val[<span class="st">"ClearanceFlag"</span>].values</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> df_test[<span class="st">"ClearanceFlag"</span>].values</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">### ------ Delete "ClearanceFlag"from the splits</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_train[<span class="st">'ClearanceFlag'</span>]</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_val[<span class="st">'ClearanceFlag'</span>]</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_test[<span class="st">'ClearanceFlag'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Numerical and Categorical features</strong></p>
<p>We drop out some features (TransactionID, ProductID, customerID) as they will not add value to our model.</p>
<div id="cell-df-head" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df.Year.head(<span class="dv">5</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>df.Year.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="df-head" class="cell-output cell-output-display" data-execution_count="49">
<pre><code>count    100000.0
mean       2024.0
std           0.0
min        2024.0
25%        2024.0
50%        2024.0
75%        2024.0
max        2024.0
Name: Year, dtype: float64</code></pre>
</div>
</div>
<p>We remove <code>Year</code> as it does not add any value.</p>
<p><strong>Numerical</strong></p>
<div id="cell-numerical-corr" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>numerical_cols <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>,<span class="st">'RevenueAbs'</span>, <span class="st">'RevenueFinal'</span>, <span class="st">'Month'</span>, <span class="st">'WeekOfYear'</span>, <span class="st">'DayOfWeek'</span>, <span class="st">'DiscountPercentage'</span>,<span class="st">'DiscountedPriceBoxCox'</span>]</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>df[numerical_cols].corrwith(df.ClearanceFlag).to_frame(<span class="st">'correlation'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="numerical-corr" class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">correlation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">OriginalPrice</td>
<td>0.002843</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">QuantityAbs</td>
<td>-0.003838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RevenueAbs</td>
<td>-0.474774</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RevenueFinal</td>
<td>-0.258259</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Month</td>
<td>-0.002561</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">WeekOfYear</td>
<td>-0.002215</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">DayOfWeek</td>
<td>-0.003218</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">DiscountPercentage</td>
<td>0.737020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">DiscountedPriceBoxCox</td>
<td>-0.253410</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Note:</strong></p>
<ul>
<li><code>DiscountPercentage</code> has a 0.74 correlation with <code>ClearanceFlag</code> indicating that higher discount percentage likely to sell the product at clearance which is obvious.</li>
<li><code>RevenueAbs</code> (-0.47) and <code>RevenueFinal</code> (-0.25) indicate that when revenue increases, the item is unlikely to have been sold at clearance.</li>
<li>Naturally increasing the <code>DiscountedPrice</code> will result in the unlikelihood of the item being sold at clearance.</li>
</ul>
<p><strong>Categorical</strong></p>
<div id="cell-categorical-MI" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert `IsReturn` into a categorical variable</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"IsReturn"</span>] <span class="op">=</span> df[<span class="st">"IsReturn"</span>].astype(<span class="st">"category"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>,<span class="st">'IsReturn'</span>,<span class="st">'TransactionType'</span>]</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">### ----- Define the function to calculate the M.I on the training set ONLY</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_mi(series):</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mutual_info_score(series, y_train)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">#### ---- Calculate MI between 'y' and the categorical variables of the training set ONLY </span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>df_mi <span class="op">=</span> df_train[categorical_cols].<span class="bu">apply</span>(calculate_mi)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>df_mi <span class="op">=</span> df_mi.sort_values(ascending<span class="op">=</span><span class="va">False</span>).to_frame(name<span class="op">=</span><span class="st">'MI'</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Below are the variable with highest M.I score:'</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>display(df_mi.head(<span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Below are the variable with highest M.I score:</code></pre>
</div>
<div id="categorical-mi" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Type</td>
<td>0.000433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Brand</td>
<td>0.000134</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">StoreID</td>
<td>0.000116</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Subcategory</td>
<td>0.000114</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Region</td>
<td>0.000077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Supplier</td>
<td>0.000027</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Category</td>
<td>0.000026</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">IsReturn</td>
<td>0.000004</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TransactionType</td>
<td>0.000004</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Note:</strong></p>
<ul>
<li>Knowing the <code>Type</code> of the product provides more information on whether or not it will be sold at clearance.</li>
<li><code>TransactionType</code> and <code>IsReturn</code> values are not very informative.</li>
<li><code>Brand</code>, <code>StoreID</code>, and <code>Subcategory</code> values also provide valuable information on the target feature status.</li>
</ul>
<p><strong>Selected Fearures</strong></p>
<div id="cell-selected-features" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on correlation</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>selected_num <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>,<span class="st">'RevenueAbs'</span>, <span class="st">'RevenueFinal'</span>, <span class="st">'DiscountPercentage'</span>,<span class="st">'DiscountedPriceBoxCox'</span>]</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on MI</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>selected_cat <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>]</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>df_train[selected_num <span class="op">+</span> selected_cat]</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>df_val[selected_num <span class="op">+</span> selected_cat]</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>df_test[selected_num <span class="op">+</span> selected_cat]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="selected-features" class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OriginalPrice</th>
<th data-quarto-table-cell-role="th">QuantityAbs</th>
<th data-quarto-table-cell-role="th">RevenueAbs</th>
<th data-quarto-table-cell-role="th">RevenueFinal</th>
<th data-quarto-table-cell-role="th">DiscountPercentage</th>
<th data-quarto-table-cell-role="th">DiscountedPriceBoxCox</th>
<th data-quarto-table-cell-role="th">StoreID</th>
<th data-quarto-table-cell-role="th">Brand</th>
<th data-quarto-table-cell-role="th">Supplier</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">75721</td>
<td>218.24</td>
<td>4</td>
<td>872.960000</td>
<td>872.96</td>
<td>30.00</td>
<td>26.853611</td>
<td>S008</td>
<td>Tommy Hilfiger</td>
<td>Nordstrom</td>
<td>Apparel</td>
<td>Outerwear</td>
<td>Blazer</td>
<td>KZN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">80184</td>
<td>282.47</td>
<td>5</td>
<td>1412.350000</td>
<td>1412.35</td>
<td>30.00</td>
<td>31.170162</td>
<td>S006</td>
<td>Zara</td>
<td>Inditex</td>
<td>Apparel</td>
<td>Dresses</td>
<td>Evening Dress</td>
<td>KZN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19864</td>
<td>109.00</td>
<td>5</td>
<td>545.000000</td>
<td>545.00</td>
<td>30.00</td>
<td>17.866154</td>
<td>S004</td>
<td>Nike</td>
<td>JD Sports</td>
<td>Accessories</td>
<td>Bags</td>
<td>Satchel</td>
<td>KZN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">76699</td>
<td>155.27</td>
<td>4</td>
<td>621.080000</td>
<td>621.08</td>
<td>30.00</td>
<td>22.017959</td>
<td>S001</td>
<td>Adidas</td>
<td>JD Sports</td>
<td>Accessories</td>
<td>Bags</td>
<td>Clutch</td>
<td>GP</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">92991</td>
<td>252.09</td>
<td>1</td>
<td>252.090000</td>
<td>252.09</td>
<td>20.00</td>
<td>31.526161</td>
<td>S010</td>
<td>Michael Kors</td>
<td>Nordstrom</td>
<td>Kids</td>
<td>Girls</td>
<td>Sandals</td>
<td>KZN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32595</td>
<td>214.89</td>
<td>3</td>
<td>65.607114</td>
<td>322.32</td>
<td>50.00</td>
<td>21.869038</td>
<td>S008</td>
<td>Zara</td>
<td>Inditex</td>
<td>Accessories</td>
<td>Jewelry</td>
<td>Necklace</td>
<td>WC</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29313</td>
<td>294.06</td>
<td>2</td>
<td>588.120000</td>
<td>-588.12</td>
<td>30.00</td>
<td>31.899540</td>
<td>S001</td>
<td>Guess</td>
<td>Asos</td>
<td>Footwear</td>
<td>Sandals</td>
<td>Flip Flops</td>
<td>KZN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37862</td>
<td>20.80</td>
<td>2</td>
<td>41.600000</td>
<td>41.60</td>
<td>30.00</td>
<td>6.371448</td>
<td>S005</td>
<td>Nike</td>
<td>JD Sports</td>
<td>Accessories</td>
<td>Jewelry</td>
<td>Necklace</td>
<td>KZN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53421</td>
<td>84.97</td>
<td>4</td>
<td>50.205867</td>
<td>169.92</td>
<td>50.01</td>
<td>12.551467</td>
<td>S008</td>
<td>DKNY</td>
<td>Bloomingdale's</td>
<td>Accessories</td>
<td>Belts</td>
<td>Canvas Belt</td>
<td>KZN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42410</td>
<td>289.43</td>
<td>3</td>
<td>868.290000</td>
<td>868.29</td>
<td>40.00</td>
<td>28.921796</td>
<td>S004</td>
<td>Adidas</td>
<td>Asos</td>
<td>Kids</td>
<td>Toys</td>
<td>Puzzle</td>
<td>WC</td>
</tr>
</tbody>
</table>

<p>20000 rows  13 columns</p>
</div>
</div>
</div>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">4.3. Cross validation</h2>
<div id="cross-validation" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># splits = 5 as we have a lot of data</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="train" class="level2">
<h2 class="anchored" data-anchor-id="train">4.4. Train</h2>
<p>We first build a base model then we try to improve upon it. For a better understanding, I will not make use of third-party package like <code>optuna</code> or <code>hyperopt</code>.</p>
<section id="base-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="base-logistic-regression">4.4.1. Base Logistic regression</h3>
<div id="base-lr" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ----- Initialize the encoder: ------</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>dv <span class="op">=</span> DictVectorizer(sparse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">## ---- Apply the transformation on the training set</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>train_dict <span class="op">=</span> df_train[selected_num <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> dv.fit_transform(train_dict)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">## ---- Apply the transformation on the validation set (for evaluation)</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>val_dict <span class="op">=</span> df_val[selected_num <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> dv.transform(val_dict)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">#### Training on Logistic regression</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>, C<span class="op">=</span><span class="fl">1.0</span>, max_iter<span class="op">=</span><span class="dv">1000</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on validation set</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_val, y_pred)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> precision_score(y_val, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)  </span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> recall_score(y_val, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Base logistic regression"</span>)</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Validation Accuracy : </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification report on baseline LR model:"</span>)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Base logistic regression
Validation Accuracy : 1.0000
Classification report on baseline LR model:
              precision    recall  f1-score   support

           0       1.00      1.00      1.00     16020
           1       1.00      1.00      1.00      3980

    accuracy                           1.00     20000
   macro avg       1.00      1.00      1.00     20000
weighted avg       1.00      1.00      1.00     20000
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Overfitting">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overfitting
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We noticed earlier a very high correlation between certain features to the clearance status. This results in a model learning for example that whenever <code>DiscountPercentage</code> is high, predict <code>ClearanceFlag</code>=Yes.</li>
<li>A feature like <code>Revenue</code> is a target-leaking feature as it was engineered based on the <code>ClearanceFlag</code> status.</li>
</ul>
<p><strong>Solution</strong>: Drop any feature that is engineered from the target feature and observe the result.</p>
</div>
</div>
<div id="base-lr-retraining" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>filtered_numerical_cols <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>, <span class="st">'Month'</span>, <span class="st">'WeekOfYear'</span>, <span class="st">'DayOfWeek'</span>]</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>selected_cat <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>, <span class="st">'IsReturn'</span>, <span class="st">'TransactionType'</span>]</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># DictVectorizer encoding</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>dv <span class="op">=</span> DictVectorizer(sparse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>train_dict <span class="op">=</span> df_train[filtered_numerical_cols <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> dv.fit_transform(train_dict)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co"># DictVectorizer encoding (val)</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>val_dict <span class="op">=</span> df_val[filtered_numerical_cols <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> dv.transform(val_dict)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Train logistic regression</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>, C<span class="op">=</span><span class="fl">1.0</span>, max_iter<span class="op">=</span><span class="dv">1000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on validation</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate performance</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_val, y_pred)</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Logistic Regression (Leakage-Free Features)"</span>)</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Accuracy : </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression (Leakage-Free Features)
  Accuracy : 0.8010

Classification Report:
              precision    recall  f1-score   support

           0       0.80      1.00      0.89     16020
           1       0.00      0.00      0.00      3980

    accuracy                           0.80     20000
   macro avg       0.40      0.50      0.44     20000
weighted avg       0.64      0.80      0.71     20000
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\dants\Documents\Projects\Faro Analytics\faro\.venv\Lib\site-packages\sklearn\metrics\_classification.py:1509: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
C:\Users\dants\Documents\Projects\Faro Analytics\faro\.venv\Lib\site-packages\sklearn\metrics\_classification.py:1509: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
C:\Users\dants\Documents\Projects\Faro Analytics\faro\.venv\Lib\site-packages\sklearn\metrics\_classification.py:1509: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Logistic Regression Base model">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Logistic Regression Base model
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>No overfitting, that is a good sign.</li>
<li>The base model never predicts class 1 (Clearance) as the accuracy is 80% which is also the percentage of observations that were sold at normal price.</li>
<li>Recall for class 1 = 0 indicating all actual clearance items are missed.</li>
<li>Precision for class 1 = 0 indicating when it predicts class 1 (which it doesnt), its always wrong.</li>
<li>Macro avg: Treats both classes equally which exposes failure on class 1.</li>
<li>Weighted avg: Dominated by class 0 which looks better but hides the issue.</li>
</ul>
<p><strong>Possible solutions:</strong> - class_weight=balanced in Logistic Regression to penalize misclassification of rare class more. - Try a sampling technique such oversampling or undersampling or SMOTE. - Use a tree-based models like decision tree.</p>
</div>
</div>
</section>
<section id="logistic-regression-with-class-weight" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-with-class-weight">4.4.2. Logistic regression with Class Weight</h3>
<div id="lr-class-weight" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>filtered_numerical_cols <span class="op">=</span> [<span class="st">'OriginalPrice'</span>, <span class="st">'QuantityAbs'</span>, <span class="st">'Month'</span>, <span class="st">'WeekOfYear'</span>, <span class="st">'DayOfWeek'</span>]</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>selected_cat <span class="op">=</span> [<span class="st">'StoreID'</span>, <span class="st">'Brand'</span>, <span class="st">'Supplier'</span>, <span class="st">'Category'</span>, <span class="st">'Subcategory'</span>, <span class="st">'Type'</span>, <span class="st">'Region'</span>, <span class="st">'IsReturn'</span>, <span class="st">'TransactionType'</span>]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Encoding with DictVectorizer ---</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>dv <span class="op">=</span> DictVectorizer(sparse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Train encoding</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>train_dict <span class="op">=</span> df_train[filtered_numerical_cols <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> dv.fit_transform(train_dict)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation encoding</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>val_dict <span class="op">=</span> df_val[filtered_numerical_cols <span class="op">+</span> selected_cat].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> dv.transform(val_dict)</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Train Logistic Regression with class_weight ---</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>,</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>                           C<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>                           max_iter<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>                           random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>                           class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Predict &amp; Evaluate ---</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_val, y_pred)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> precision_score(y_val, y_pred, average<span class="op">=</span><span class="st">'macro'</span>)</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> recall_score(y_val, y_pred, average<span class="op">=</span><span class="st">'macro'</span>)</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Logistic Regression with class_weight='balanced'"</span>)</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Accuracy : </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Logistic Regression with class_weight='balanced'
  Accuracy : 0.5130

Classification Report:
              precision    recall  f1-score   support

           0       0.80      0.52      0.63     16020
           1       0.20      0.49      0.28      3980

    accuracy                           0.51     20000
   macro avg       0.50      0.50      0.46     20000
weighted avg       0.68      0.51      0.56     20000
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="LR Underfitting">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
LR Underfitting
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Imbalance remains an issue: Even though class weighting was used, class 1 (the minority class) is still poorly predicted.</li>
<li>High precision on class 0: Model is very good at avoiding false positives for class 0.</li>
<li>Low precision on class 1: Only 20% of predicted positives are truly class 1  lots of false positives for minority class.</li>
<li>Recall for class 1 is 0.49: It recovers ~49% of true class 1 cases  improved sensitivity, but at a precision cost.</li>
<li>Overall accuracy is misleading: 51% accuracy is barely better than random guessing because the class distribution is imbalanced.</li>
</ul>
</div>
</div>
</section>
<section id="decision-tree" class="level3">
<h3 class="anchored" data-anchor-id="decision-tree">4.4.3. Decision tree</h3>
<div id="decision-tree" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define hyperparameters to tune for Decision Tree</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>max_depth_values <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="va">None</span>]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>min_samples_leaf_values <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>]</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare dictionary to store results</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {}</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampling methods dict</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>sampling_methods <span class="op">=</span> {</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SMOTE'</span>: SMOTE(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Undersampling'</span>: RandomUnderSampler(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Oversampling'</span>: RandomOverSampler(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sampling_name, sampler <span class="kw">in</span> sampling_methods.items():</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Sampling: </span><span class="sc">{</span>sampling_name<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply sampling on training data</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    X_resampled, y_resampled <span class="op">=</span> sampler.fit_resample(X_train, y_train)</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    best_f1 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hyperparameter tuning loop</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> max_depth <span class="kw">in</span> max_depth_values:</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> min_samples_leaf <span class="kw">in</span> min_samples_leaf_values:</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>            dt <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>                max_depth<span class="op">=</span>max_depth,</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>                min_samples_leaf<span class="op">=</span>min_samples_leaf,</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>                class_weight<span class="op">=</span><span class="st">'balanced'</span>,</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>                random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>            dt.fit(X_resampled, y_resampled)</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> dt.predict(X_val)</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Evaluate with macro F1 </span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>            <span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score</span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>            f1 <span class="op">=</span> f1_score(y_val, y_pred, average<span class="op">=</span><span class="st">'macro'</span>)</span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> f1 <span class="op">&gt;</span> best_f1:</span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>                best_f1 <span class="op">=</span> f1</span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>                best_params <span class="op">=</span> (max_depth, min_samples_leaf)</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>                best_model <span class="op">=</span> dt</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final evaluation with best model</span></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>    y_pred_best <span class="op">=</span> best_model.predict(X_val)</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best params: max_depth=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, min_samples_leaf=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best macro F1-score: </span><span class="sc">{</span>best_f1<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy_score(y_val, y_pred_best)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Precision (macro): {precision_score(y_val, y_pred_best, average='macro'):.4f}")</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Recall (macro): {recall_score(y_val, y_pred_best, average='macro'):.4f}")</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y_val, y_pred_best))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Sampling: SMOTE ---
Best params: max_depth=None, min_samples_leaf=1
Best macro F1-score: 0.5020
Accuracy: 0.6678

Classification Report:
              precision    recall  f1-score   support

           0       0.80      0.78      0.79     16020
           1       0.20      0.23      0.21      3980

    accuracy                           0.67     20000
   macro avg       0.50      0.50      0.50     20000
weighted avg       0.68      0.67      0.67     20000


--- Sampling: Undersampling ---
Best params: max_depth=10, min_samples_leaf=1
Best macro F1-score: 0.5007
Accuracy: 0.6443

Classification Report:
              precision    recall  f1-score   support

           0       0.80      0.74      0.77     16020
           1       0.20      0.27      0.23      3980

    accuracy                           0.64     20000
   macro avg       0.50      0.50      0.50     20000
weighted avg       0.68      0.64      0.66     20000


--- Sampling: Oversampling ---
Best params: max_depth=None, min_samples_leaf=1
Best macro F1-score: 0.5012
Accuracy: 0.6687

Classification Report:
              precision    recall  f1-score   support

           0       0.80      0.78      0.79     16020
           1       0.20      0.22      0.21      3980

    accuracy                           0.67     20000
   macro avg       0.50      0.50      0.50     20000
weighted avg       0.68      0.67      0.68     20000
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Decision Tree Underfitting">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Decision Tree Underfitting
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Macro F1 is flat (~0.50) across all three  the model handles imbalance slightly better than random but struggles with minority class.</li>
<li>Class 1 Recall ~0.220.27: Some improvement over default behavior, but still poor.</li>
<li>Accuracy is misleading, driven mainly by the dominant class (class 0 with 80%+ support).</li>
<li>Precision for class 1 is low (~0.20) indicating many false positives.</li>
</ul>
<p><strong>Improvement alternatives:</strong></p>
<ul>
<li>Tune the weight in a cost-sensitive way.</li>
<li>Use <code>Grid search</code> or <code>Random search</code> or even <code>simulated annealing</code></li>
<li>Perform more feature engineering.</li>
</ul>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>